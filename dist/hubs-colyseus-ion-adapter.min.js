!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.ArraySchema=void 0;var s=function(e){function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.apply(this,n)||this;return Object.setPrototypeOf(o,Object.create(t.prototype)),Object.defineProperties(o,{$sorting:{value:void 0,enumerable:!1,writable:!0},$changes:{value:void 0,enumerable:!1,writable:!0},onAdd:{value:void 0,enumerable:!1,writable:!0},onRemove:{value:void 0,enumerable:!1,writable:!0},onChange:{value:void 0,enumerable:!1,writable:!0},triggerAll:{value:function(){if(o.onAdd)for(var e=0;e<o.length;e++)o.onAdd(o[e],e)}},toJSON:{value:function(){for(var e=[],t=0;t<o.length;t++){var n=o[t];e.push("function"==typeof n.toJSON?n.toJSON():n)}return e}},clone:{value:function(e){var n;return e?((n=t.of.apply(t,o)).onAdd=o.onAdd,n.onRemove=o.onRemove,n.onChange=o.onChange):n=new(t.bind.apply(t,i([void 0],o.map((function(e){return"object"==typeof e?e.clone():e}))))),n}}}),o}return o(t,e),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.sort=function(t){if(this.$sorting=!0,e.prototype.sort.call(this,t),this.$changes)for(var n=0,r=Array.from(this.$changes.changes);n<r.length;n++){var o=r[n],i=this.$changes.getIndex(this[o]);void 0!==i&&this.$changes.mapIndexChange(this[o],i),this.$changes.mapIndex(this[o],o)}return this.$sorting=!1,this},t.prototype.filter=function(t,n){var r=e.prototype.filter.call(this,t);return r.$changes=this.$changes.clone(),r},t.prototype.splice=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Array.prototype.splice.apply(this,arguments),i=Array.prototype.filter.call(this,(function(n,r){return r>=e+t-1}));return o.map((function(e){var t=e&&e.$changes;t&&(t.parent.deleteIndex(e),delete t.parent)})),i.forEach((function(e){var t=e&&e.$changes;t&&t.parentField--})),o},t}(Array);t.ArraySchema=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapSchema=void 0;var r=function e(t){var n=this;for(var r in void 0===t&&(t={}),t)this[r]=t[r];Object.defineProperties(this,{$changes:{value:void 0,enumerable:!1,writable:!0},onAdd:{value:void 0,enumerable:!1,writable:!0},onRemove:{value:void 0,enumerable:!1,writable:!0},onChange:{value:void 0,enumerable:!1,writable:!0},clone:{value:function(t){var r;if(t)(r=Object.assign(new e,n)).onAdd=n.onAdd,r.onRemove=n.onRemove,r.onChange=n.onChange;else{var o=new e;for(var i in n)"object"==typeof n[i]?o[i]=n[i].clone():o[i]=n[i]}return r}},triggerAll:{value:function(){if(n.onAdd)for(var e in n)n.onAdd(n[e],e)}},toJSON:{value:function(){var e={};for(var t in n)e[t]="function"==typeof n[t].toJSON?n[t].toJSON():n[t];return e}},_indexes:{value:new Map,enumerable:!1,writable:!0},_updateIndexes:{value:function(e){for(var t=0,r=new Map,o=0,i=e;o<i.length;o++){var s=i[o];r.set(s,t++)}n._indexes=r}}})};t.MapSchema=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=t.LocalStream=t.Client=void 0;const r=n(48);t.Client=r.default;const o=n(21);Object.defineProperty(t,"LocalStream",{enumerable:!0,get:function(){return o.LocalStream}}),Object.defineProperty(t,"Stream",{enumerable:!0,get:function(){return o.Stream}})},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Schema=void 0;var i=n(13),s=n(11),a=n(12),c=n(0),u=n(1),h=n(16),l=n(45),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(Error);function d(e,t,n,r){if(!(e instanceof t))throw new f("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+r)}function p(e,t,n,r,o){!function(e,t,n,r){var o,i=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(e)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+r);break;case"string":o="string",i=!0;break;case"boolean":return}if(typeof e!==o&&(!i||i&&null!==e)){var s="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")");throw new f("a '"+o+"' was expected, but "+s+" was provided in "+n.constructor.name+"#"+r)}}(n,e,r,o);var i=s[e];if(!i)throw new f("a '"+e+"' was expected, but "+n+" was provided in "+r.constructor.name+"#"+o);i(t,n)}function m(e,t,n){return a[e](t,n)}var v=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new h.ChangeTree(this._indexes),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var n=this._descriptors;n&&Object.defineProperties(this,n)}return e.onError=function(e){console.error(e)},Object.defineProperty(e.prototype,"_schema",{get:function(){return this.constructor._schema},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_descriptors",{get:function(){return this.constructor._descriptors},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_indexes",{get:function(){return this.constructor._indexes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_fieldsByIndex",{get:function(){return this.constructor._fieldsByIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_filters",{get:function(){return this.constructor._filters},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_deprecated",{get:function(){return this.constructor._deprecated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$changed",{get:function(){return this.$changes.changed},enumerable:!1,configurable:!0}),e.prototype.listen=function(e,t){var n=this;return this.$listeners[e]||(this.$listeners[e]=new l.EventEmitter),this.$listeners[e].register(t),function(){return n.$listeners[e].remove(t)}},e.prototype.decode=function(t,n){void 0===n&&(n={offset:0});var r=[],o=this._schema,s=this._fieldsByIndex,h=t.length;t[n.offset]===i.TYPE_ID&&(n.offset+=2);for(var l=function(){var h=a.nilCheck(t,n)&&++n.offset,l=t[n.offset++];if(l===i.END_OF_STRUCTURE)return"break";var d=s[l],p="_"+d,v=o[d],g=void 0,y=f[p],b=!1;if(!d)return"continue";if(h)g=null,b=!0;else if(v._schema)y=y&&f[p].clone(),(g=f[p]||f.createTypeInstance(t,n,v)).decode(t,n),b=!0;else if(Array.isArray(v)){v=v[0];var _=f[p]||new c.ArraySchema;g=_.clone(!0);var w=a.number(t,n),C=Math.min(a.number(t,n),w),S=g.length>w;b=C>0||S;var O=!1;S&&Array.prototype.splice.call(g,w).forEach((function(t,n){if(t&&t.onRemove)try{t.onRemove()}catch(t){e.onError(t)}if(_.onRemove)try{_.onRemove(t,w+n)}catch(t){e.onError(t)}}));for(var E=0;E<C;E++){var A=a.number(t,n),k=void 0;a.indexChangeCheck(t,n)&&(a.uint8(t,n),k=a.number(t,n),O=!0);var I=!O&&void 0===g[A]||O&&void 0===k;if(v.prototype instanceof e){var P=void 0;(P=I?f.createTypeInstance(t,n,v):void 0!==k?_[k]:_[A])||(P=f.createTypeInstance(t,n,v),I=!0),P.decode(t,n),g[A]=P}else g[A]=m(v,t,n);if(I){if(_.onAdd)try{_.onAdd(g[A],A)}catch(t){e.onError(t)}}else if(_.onChange)try{_.onChange(g[A],A)}catch(t){e.onError(t)}}}else if(v.map){v=v.map;var T=f[p]||new u.MapSchema;g=T.clone(!0);var R=a.number(t,n);b=R>0;O=!1;var j=Object.keys(T);for(E=0;E<R&&(void 0!==t[n.offset]&&t[n.offset]!==i.END_OF_STRUCTURE);E++){var M=a.nilCheck(t,n)&&++n.offset,x=void 0;a.indexChangeCheck(t,n)&&(a.uint8(t,n),x=j[a.number(t,n)],O=!0);var N=a.numberCheck(t,n),F="string"!=typeof v,L=N?j[a.number(t,n)]:a.string(t,n);P=void 0;if(P=(I=!O&&void 0===T[L]||O&&void 0===x&&N)&&F?f.createTypeInstance(t,n,v):void 0!==x?T[x]:T[L],M){if(P&&P.onRemove)try{P.onRemove()}catch(t){e.onError(t)}if(T.onRemove)try{T.onRemove(P,L)}catch(t){e.onError(t)}delete g[L]}else if(F?(P.decode(t,n),g[L]=P):g[L]=m(v,t,n),I){if(T.onAdd)try{T.onAdd(g[L],L)}catch(t){e.onError(t)}}else if(T.onChange)try{T.onChange(g[L],L)}catch(t){e.onError(t)}}}else b=(g=m(v,t,n))!==f[p];b&&(f.onChange||f.$listeners[d])&&r.push({field:d,value:g,previousValue:y}),f[p]=g},f=this;n.offset<h;){if("break"===l())break}return this._triggerChanges(r),this},e.prototype.encode=function(e,t,n,r){var o=this;if(void 0===e&&(e=this),void 0===t&&(t=!1),void 0===r&&(r=[]),!this.$changes.changed&&!t)return this._encodeEndOfStructure(this,e,r),r;for(var a=this._schema,h=this._indexes,l=this._fieldsByIndex,f=this._filters,m=Array.from(t?this.$changes.allChanges:this.$changes.changes).sort(),v=function(v,y){var b=l[m[v]]||m[v],_="_"+b,w=a[b],C=f&&f[b],S=g[_],O=h[b];if(void 0===S)s.uint8(r,i.NIL),s.number(r,O);else if(w._schema){if(n&&C&&!C.call(g,n,S,e))return"continue";S?(s.number(r,O),d(S,w,g,b),g.tryEncodeTypeId(r,w,S.constructor),S.encode(e,t,n,r)):(s.uint8(r,i.NIL),s.number(r,O))}else if(Array.isArray(w)){var E=S.$changes;if(n&&C&&!C.call(g,n,S,e))return"continue";s.number(r,O),s.number(r,S.length);var A=Array.from(t?E.allChanges:E.changes).filter((function(e){return void 0!==o[_][e]})).sort((function(e,t){return e-t})),k=A.length;s.number(r,k);var I="string"!=typeof w[0];d(g[_],c.ArraySchema,g,b);for(var P=0;P<k;P++){var T=A[P],R=g[_][T];if(I){if(s.number(r,T),!t)void 0!==(L=E.getIndexChange(R))&&(s.uint8(r,i.INDEX_CHANGE),s.number(r,L));d(R,w[0],g,b),g.tryEncodeTypeId(r,w[0],R.constructor),R.encode(e,t,n,r)}else void 0!==R&&(s.number(r,T),p(w[0],r,R,g,b))}t||n||E.discard()}else if(w.map){E=S.$changes;if(n&&C&&!C.call(g,n,S,e))return"continue";s.number(r,O);var j=Array.from(t?E.allChanges:E.changes);s.number(r,j.length);var M=Array.from(E.allChanges);I="string"!=typeof w.map,k=j.length;d(g[_],u.MapSchema,g,b);for(var x=0;x<k;x++){var N=j[x],F=(R=g[_][N],void 0);if(t){if(void 0===R)continue}else{var L=E.getIndexChange(R);R&&void 0!==L&&(s.uint8(r,i.INDEX_CHANGE),s.number(r,g[_]._indexes.get(L))),F=E.isDeleted(N)&&R?void 0:g[_]._indexes.get(N)}var D=void 0===R;D&&s.uint8(r,i.NIL),void 0!==F?s.number(r,F):s.string(r,N),R&&I?(d(R,w.map,g,b),g.tryEncodeTypeId(r,w.map,R.constructor),R.encode(e,t,n,r)):D||p(w.map,r,R,g,b)}t||n||(E.discard(),g[_]._updateIndexes(M))}else{if(n&&C&&!C.call(g,n,S,e))return"continue";s.number(r,O),p(w,r,S,g,b)}},g=this,y=0,b=m.length;y<b;y++)v(y);return this._encodeEndOfStructure(this,e,r),t||n||this.$changes.discard(),r},e.prototype.encodeFiltered=function(e,t){return this.encode(this,!1,e,t)},e.prototype.encodeAll=function(e){return this.encode(this,!0,void 0,e)},e.prototype.encodeAllFiltered=function(e,t){return this.encode(this,!0,e,t)},e.prototype.clone=function(){var e=new this.constructor,t=this._schema;for(var n in t)"object"==typeof this[n]&&"function"==typeof this[n].clone?e[n]=this[n].clone():e[n]=this[n];return e},e.prototype.triggerAll=function(){var t=[],n=this._schema;for(var r in n)void 0!==this[r]&&t.push({field:r,value:this[r],previousValue:void 0});try{this._triggerChanges(t)}catch(t){e.onError(t)}},e.prototype.toJSON=function(){var e=this._schema,t=this._deprecated,n={};for(var r in e)t[r]||null===this[r]||void 0===this[r]||(n[r]="function"==typeof this[r].toJSON?this[r].toJSON():this["_"+r]);return n},e.prototype.discardAllChanges=function(){var t=this._schema,n=Array.from(this.$changes.changes),r=this._fieldsByIndex;for(var o in n){var i=r[o],s=t[i],a=this[i];if(void 0!==a)if(s._schema)a.discardAllChanges();else if(Array.isArray(s)){for(var c=0,u=a.length;c<u;c++){var h=a[c],l=this["_"+i][h];"string"!=typeof s[0]&&l&&l.discardAllChanges()}a.$changes.discard()}else if(s.map){var f=a,d=Object.keys(this["_"+i]);for(c=0;c<f.length;c++){var p=d[f[c]]||f[c];(l=this["_"+i][p])instanceof e&&l&&l.discardAllChanges()}a.$changes.discard()}}this.$changes.discard()},e.prototype._encodeEndOfStructure=function(e,t,n){e!==t&&n.push(i.END_OF_STRUCTURE)},e.prototype.tryEncodeTypeId=function(e,t,n){t._typeid!==n._typeid&&(s.uint8(e,i.TYPE_ID),s.uint8(e,n._typeid))},e.prototype.createTypeInstance=function(e,t,n){return e[t.offset]===i.TYPE_ID?(t.offset++,new(this.constructor._context.get(a.uint8(e,t)))):new n},e.prototype._triggerChanges=function(t){if(t.length>0){for(var n=0;n<t.length;n++){var r=t[n],o=this.$listeners[r.field];if(o)try{o.invoke(r.value,r.previousValue)}catch(t){e.onError(t)}}if(this.onChange)try{this.onChange(t)}catch(t){e.onError(t)}}},e}();t.Schema=v},function(e,t,n){const r=n(52),o="protoo-client";e.exports=class{constructor(e){e?(this._debug=r(`${o}:${e}`),this._warn=r(`${o}:WARN:${e}`),this._error=r(`${o}:ERROR:${e}`)):(this._debug=r(o),this._warn=r(o+":WARN"),this._error=r(o+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},function(e,t,n){var r,o;!function(i,s){"use strict";void 0===(o="function"==typeof(r=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function i(n){return"debug"===n&&(n="log"),"undefined"!=typeof console&&("trace"===n&&t?o:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}function s(t,r){for(var o=0;o<n.length;o++){var i=n[o];this[i]=o<t?e:this.methodFactory(i,t,r)}this.log=this.debug}function a(e,t,n){return function(){"undefined"!=typeof console&&(s.call(this,t,n),this[e].apply(this,arguments))}}function c(e,t,n){return i(e)||a.apply(this,arguments)}function u(e,t,r){var o,i=this,a="loglevel";function u(){var e;if("undefined"!=typeof window){try{e=window.localStorage[a]}catch(e){}if(void 0===e)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(a)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===i.levels[e]&&(e=void 0),e}}e&&(a+=":"+e),i.name=e,i.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},i.methodFactory=r||c,i.getLevel=function(){return o},i.setLevel=function(t,r){if("string"==typeof t&&void 0!==i.levels[t.toUpperCase()]&&(t=i.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=i.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(o=t,!1!==r&&function(e){var t=(n[e]||"silent").toUpperCase();if("undefined"!=typeof window){try{return void(window.localStorage[a]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(a)+"="+t+";"}catch(e){}}}(t),s.call(i,t,e),"undefined"==typeof console&&t<i.levels.SILENT)return"No console available for logging"},i.setDefaultLevel=function(e){u()||i.setLevel(e,!1)},i.enableAll=function(e){i.setLevel(i.levels.TRACE,e)},i.disableAll=function(e){i.setLevel(i.levels.SILENT,e)};var h=u();null==h&&(h=null==t?"WARN":t),i.setLevel(h,!1)}var h=new u,l={};h.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new u(e,h.getLevel(),h.methodFactory)),t};var f="undefined"!=typeof window?window.log:void 0;return h.noConflict=function(){return"undefined"!=typeof window&&window.log===h&&(window.log=f),h},h.getLoggers=function(){return l},h})?r.call(t,n,t,e):r)||(e.exports=o)}()},function(e,t){function n(e,t){t.headers=e.headers||{},t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.response}t.send=function(e,t,r){return new Promise((function(o,i){var s,a,c,u;r=r||{};var h=new XMLHttpRequest,l=r.headers||{};for(s in r.timeout&&(h.timeout=r.timeout),h.ontimeout=h.onerror=function(e){e.timeout="timeout"==e.type,i(e)},h.open(e,t.href||t),h.onload=function(){for(u=h.getAllResponseHeaders().trim().split(/[\r\n]+/),n(h,h);c=u.shift();)c=c.split(": "),h.headers[c.shift().toLowerCase()]=c.join(": ");if((c=h.headers["content-type"])&&~c.indexOf("application/json"))try{h.data=JSON.parse(h.data,r.reviver)}catch(e){return n(h,e),i(e)}(h.status>=400?i:o)(h)},(a=r.body)&&"object"==typeof a&&(l["content-type"]="application/json",a=JSON.stringify(a)),h.withCredentials=!!r.withCredentials,l)h.setRequestHeader(s,l[s]);h.send(a)}))},t.get=t.send.bind(t.send,"GET"),t.post=t.send.bind(t.send,"POST"),t.patch=t.send.bind(t.send,"PATCH"),t.del=t.send.bind(t.send,"DELETE"),t.put=t.send.bind(t.send,"PUT")},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;var s=i(n(8)),a=n(31),c=n(32),u=n(33),h=n(9),l=n(10),f=i(n(11)),d=i(n(12)),p=function(){function e(e,t){var n=this;this.onJoin=a.createSignal(),this.onStateChange=a.createSignal(),this.onError=a.createSignal(),this.onLeave=a.createSignal(),this.hasJoined=!1,this.onMessageHandlers=c.createNanoEvents(),this.id=null,this.name=e,t?(this.serializer=new(h.getSerializer("schema")),this.rootSchema=t,this.serializer.state=new t):this.serializer=new(h.getSerializer("fossil-delta")),this.onError((function(e,t){return console.error("colyseus.js - onError => ("+e+") "+t)})),this.onLeave((function(){return n.removeAllListeners()}))}return e.prototype.connect=function(e){var t=this;this.connection=new u.Connection(e,!1),this.connection.reconnectEnabled=!1,this.connection.onmessage=this.onMessageCallback.bind(this),this.connection.onclose=function(e){if(!t.hasJoined)return console.error("Room connection was closed unexpectedly ("+e.code+"): "+e.reason),void t.onError.invoke(e.code,e.reason);t.onLeave.invoke(e.code)},this.connection.onerror=function(e){console.warn("Room, onError ("+e.code+"): "+e.reason),t.onError.invoke(e.code,e.reason)},this.connection.open()},e.prototype.leave=function(e){void 0===e&&(e=!0),this.connection?e?this.connection.send([l.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(4e3)},e.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)},e.prototype.send=function(e,t){var n,r=[l.Protocol.ROOM_DATA];if("string"==typeof e?f.string(r,e):f.number(r,e),void 0!==t){var o=s.encode(t);(n=new Uint8Array(r.length+o.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(o),r.length)}else n=new Uint8Array(r);this.connection.send(n.buffer)},Object.defineProperty(e.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),e.prototype.listen=function(e,t,n){if("schema"!==this.serializerId)return this.serializerId||console.warn("room.Listen() should be called after room.onJoin has been called (DEPRECATION WARNING)"),this.serializer.api.listen(e,t,n);console.error("'"+this.serializerId+"' serializer doesn't support .listen() method here.")},e.prototype.removeListener=function(e){return this.serializer.api.removeListener(e)},e.prototype.removeAllListeners=function(){this.serializer&&this.serializer.teardown(),this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear()},e.prototype.onMessageCallback=function(e){var t=Array.from(new Uint8Array(e.data)),n=t[0];if(n===l.Protocol.JOIN_ROOM){var r=1;this.serializerId=l.utf8Read(t,r),r+=l.utf8Length(this.serializerId);var o=h.getSerializer(this.serializerId);if(!o)throw new Error("missing serializer: "+this.serializerId);"fossil-delta"===this.serializerId||this.rootSchema||(this.serializer=new o),t.length>r&&this.serializer.handshake&&this.serializer.handshake(t,{offset:1}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([l.Protocol.JOIN_ROOM])}else if(n===l.Protocol.ERROR){var i={offset:1},a=d.number(t,i),c=d.string(t,i);this.onError.invoke(a,c)}else if(n===l.Protocol.LEAVE_ROOM)this.leave();else if(n===l.Protocol.ROOM_DATA_SCHEMA){(c=new(f=this.serializer.getState().constructor._context.get(t[1]))).decode(t,{offset:2}),this.dispatchMessage(f,c)}else if(n===l.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(n===l.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(n===l.Protocol.ROOM_DATA){var u={offset:1},f=d.stringCheck(t,u)?d.string(t,u):d.number(t,u);c=t.length>u.offset?s.decode(e.data,u.offset):void 0;this.dispatchMessage(f,c)}},e.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())},e.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())},e.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):console.warn("onMessage not registered for type '"+e+"'.")},e.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}},e}();t.Room=p},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.encode=t.decode=void 0;var o=r(n(29)),i=r(n(30));t.decode=o.default,t.encode=i.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSerializer=t.registerSerializer=void 0;var r={};t.registerSerializer=function(e,t){r[e]=t},t.getSerializer=function(e){return r[e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utf8Length=t.utf8Read=t.ErrorCode=t.Protocol=void 0,function(e){e[e.HANDSHAKE=9]="HANDSHAKE",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.ERROR=11]="ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA"}(t.Protocol||(t.Protocol={})),function(e){e[e.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",e[e.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",e[e.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",e[e.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",e[e.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",e[e.AUTH_FAILED=4215]="AUTH_FAILED",e[e.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(t.ErrorCode||(t.ErrorCode={})),t.utf8Read=function(e,t){for(var n=e[t++],r="",o=0,i=t,s=t+n;i<s;i++){var a=e[i];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(o=(7&a)<<18|(63&e[++i])<<12|(63&e[++i])<<6|(63&e[++i])<<0)>=65536?(o-=65536,r+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):r+=String.fromCharCode(o)}else r+=String.fromCharCode((15&a)<<12|(63&e[++i])<<6|(63&e[++i])<<0);else r+=String.fromCharCode((31&a)<<6|63&e[++i]);else r+=String.fromCharCode(a)}return r},t.utf8Length=function(e){void 0===e&&(e="");for(var t=0,n=0,r=0,o=e.length;r<o;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n+1}},function(e,t,n){"use strict";function r(e,t,n){for(var r=0,o=0,i=n.length;o<i;o++)(r=n.charCodeAt(o))<128?e[t++]=r:r<2048?(e[t++]=192|r>>6,e[t++]=128|63&r):r<55296||r>=57344?(e[t++]=224|r>>12,e[t++]=128|r>>6&63,e[t++]=128|63&r):(o++,r=65536+((1023&r)<<10|1023&n.charCodeAt(o)),e[t++]=240|r>>18,e[t++]=128|r>>12&63,e[t++]=128|r>>6&63,e[t++]=128|63&r)}function o(e,t){e.push(255&t)}function i(e,t){e.push(255&t)}function s(e,t){e.push(255&t),e.push(t>>8&255)}function a(e,t){e.push(255&t),e.push(t>>8&255)}function c(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function u(e,t){var n=t>>24,r=t>>16,o=t>>8,i=t;e.push(255&i),e.push(255&o),e.push(255&r),e.push(255&n)}function h(e,t){var n=Math.floor(t/Math.pow(2,32));u(e,t>>>0),u(e,n)}function l(e,t){var n=t/Math.pow(2,32)>>0;u(e,t>>>0),u(e,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.number=t.string=t.boolean=t.writeFloat64=t.writeFloat32=t.float64=t.float32=t.uint64=t.int64=t.uint32=t.int32=t.uint16=t.int16=t.uint8=t.int8=t.utf8Write=void 0,t.utf8Write=r,t.int8=o,t.uint8=i,t.int16=s,t.uint16=a,t.int32=c,t.uint32=u,t.int64=h,t.uint64=l,t.float32=function(e,t){m(e,t)},t.float64=function(e,t){v(e,t)};var f=new Int32Array(2),d=new Float32Array(f.buffer),p=new Float64Array(f.buffer);function m(e,t){d[0]=t,c(e,f[0])}function v(e,t){p[0]=t,c(e,f[0]),c(e,f[1])}t.writeFloat32=m,t.writeFloat64=v,t.boolean=function(e,t){return i(e,t?1:0)},t.string=function(e,t){t||(t="");var n=function(e){for(var t=0,n=0,r=0,o=e.length;r<o;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(t),o=0;if(n<32)e.push(160|n),o=1;else if(n<256)e.push(217),i(e,n),o=2;else if(n<65536)e.push(218),a(e,n),o=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219),u(e,n),o=5}return r(e,e.length,t),o+n},t.number=function e(t,n){return isNaN(n)?e(t,0):isFinite(n)?n!==(0|n)?(t.push(203),v(t,n),9):n>=0?n<128?(i(t,n),1):n<256?(t.push(204),i(t,n),2):n<65536?(t.push(205),a(t,n),3):n<4294967296?(t.push(206),u(t,n),5):(t.push(207),l(t,n),9):n>=-32?(t.push(n),1):n>=-128?(t.push(208),o(t,n),2):n>=-32768?(t.push(209),s(t,n),3):n>=-2147483648?(t.push(210),c(t,n),5):(t.push(211),h(t,n),9):e(t,n>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.indexChangeCheck=t.nilCheck=t.arrayCheck=t.numberCheck=t.number=t.stringCheck=t.string=t.boolean=t.readFloat64=t.readFloat32=t.uint64=t.int64=t.float64=t.float32=t.uint32=t.int32=t.uint16=t.int16=t.uint8=t.int8=void 0;var r=n(13);function o(e,t){return i(e,t)<<24>>24}function i(e,t){return e[t.offset++]}function s(e,t){return a(e,t)<<16>>16}function a(e,t){return e[t.offset++]|e[t.offset++]<<8}function c(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function u(e,t){return c(e,t)>>>0}function h(e,t){var n=u(e,t);return c(e,t)*Math.pow(2,32)+n}function l(e,t){var n=u(e,t);return u(e,t)*Math.pow(2,32)+n}t.int8=o,t.uint8=i,t.int16=s,t.uint16=a,t.int32=c,t.uint32=u,t.float32=function(e,t){return m(e,t)},t.float64=function(e,t){return v(e,t)},t.int64=h,t.uint64=l;var f=new Int32Array(2),d=new Float32Array(f.buffer),p=new Float64Array(f.buffer);function m(e,t){return f[0]=c(e,t),d[0]}function v(e,t){return f[0]=c(e,t),f[1]=c(e,t),p[0]}t.readFloat32=m,t.readFloat64=v,t.boolean=function(e,t){return i(e,t)>0},t.string=function(e,t){var n,r=e[t.offset++];r<192?n=31&r:217===r?n=i(e,t):218===r?n=a(e,t):219===r&&(n=u(e,t));var o=function(e,t,n){for(var r="",o=0,i=t,s=t+n;i<s;i++){var a=e[i];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(o=(7&a)<<18|(63&e[++i])<<12|(63&e[++i])<<6|(63&e[++i])<<0)>=65536?(o-=65536,r+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):r+=String.fromCharCode(o)}else r+=String.fromCharCode((15&a)<<12|(63&e[++i])<<6|(63&e[++i])<<0);else r+=String.fromCharCode((31&a)<<6|63&e[++i]);else r+=String.fromCharCode(a)}return r}(e,t.offset,n);return t.offset+=n,o},t.stringCheck=function(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n},t.number=function(e,t){var n=e[t.offset++];return n<128?n:202===n?m(e,t):203===n?v(e,t):204===n?i(e,t):205===n?a(e,t):206===n?u(e,t):207===n?l(e,t):208===n?o(e,t):209===n?s(e,t):210===n?c(e,t):211===n?h(e,t):n>223?-1*(255-n+1):void 0},t.numberCheck=function(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211},t.arrayCheck=function(e,t){return e[t.offset]<160},t.nilCheck=function(e,t){return e[t.offset]===r.NIL},t.indexChangeCheck=function(e,t){return e[t.offset]===r.INDEX_CHANGE}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_ID=t.INDEX_CHANGE=t.NIL=t.END_OF_STRUCTURE=void 0,t.END_OF_STRUCTURE=193,t.NIL=192,t.INDEX_CHANGE=212,t.TYPE_ID=213},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=t.Platform=void 0;var c=i(n(6)),u=n(37);!function(e){e.ios="ios",e.android="android"}(t.Platform||(t.Platform={}));var h=function(){function e(e){var t=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=e.replace("ws","http"),u.getItem("colyseus-auth-token",(function(e){return t.token=e}))}return Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),e.prototype.login=function(e){return void 0===e&&(e={}),s(this,void 0,void 0,(function(){var t,n,r;return a(this,(function(o){switch(o.label){case 0:return t=Object.assign({},e),this.hasToken&&(t.token=this.token),[4,this.request("post","/auth",t)];case 1:for(r in n=o.sent(),this.token=n.token,u.setItem("colyseus-auth-token",this.token),n)this.hasOwnProperty(r)&&(this[r]=n[r]);return this.registerPingService(),[2,this]}}))}))},e.prototype.save=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return e.sent(),[2,this]}}))}))},e.prototype.getFriends=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}}))}))},e.prototype.getOnlineFriends=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}}))}))},e.prototype.getFriendRequests=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}}))}))},e.prototype.sendFriendRequest=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.acceptFriendRequest=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.declineFriendRequest=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.blockUser=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.unblockUser=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))},e.prototype.request=function(e,t,n,r,o){return void 0===n&&(n={}),void 0===o&&(o={}),s(this,void 0,void 0,(function(){var i,s,u,h;return a(this,(function(a){switch(a.label){case 0:for(s in o.Accept="application/json",this.hasToken&&(o.Authorization="Bearer "+this.token),i=[],n)i.push(s+"="+n[s]);return u=i.length>0?"?"+i.join("&"):"",h={headers:o},r&&(h.body=r),[4,c[e](""+this.endpoint+t+u,h)];case 1:return[2,a.sent().data]}}))}))},e.prototype.logout=function(){this.token=void 0,u.removeItem("colyseus-auth-token"),this.unregisterPingService()},e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval((function(){return t.request("get","/auth")}),e)},e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},e}();t.Auth=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);Object.defineProperty(t,"Schema",{enumerable:!0,get:function(){return r.Schema}});var o=n(1);Object.defineProperty(t,"MapSchema",{enumerable:!0,get:function(){return o.MapSchema}});var i=n(0);Object.defineProperty(t,"ArraySchema",{enumerable:!0,get:function(){return i.ArraySchema}});var s=n(46);Object.defineProperty(t,"dumpChanges",{enumerable:!0,get:function(){return s.dumpChanges}});var a=n(47);Object.defineProperty(t,"Reflection",{enumerable:!0,get:function(){return a.Reflection}}),Object.defineProperty(t,"ReflectionType",{enumerable:!0,get:function(){return a.ReflectionType}}),Object.defineProperty(t,"ReflectionField",{enumerable:!0,get:function(){return a.ReflectionField}});var c=n(17);Object.defineProperty(t,"type",{enumerable:!0,get:function(){return c.type}}),Object.defineProperty(t,"deprecated",{enumerable:!0,get:function(){return c.deprecated}}),Object.defineProperty(t,"filter",{enumerable:!0,get:function(){return c.filter}}),Object.defineProperty(t,"defineTypes",{enumerable:!0,get:function(){return c.defineTypes}}),Object.defineProperty(t,"Context",{enumerable:!0,get:function(){return c.Context}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeTree=void 0;var r=n(3),o=n(0),i=n(1),s=function(){function e(e,t,n){void 0===e&&(e={}),void 0===t&&(t=null),this.changed=!1,this.changes=new Set,this.allChanges=new Set,this.deletedKeys={},this.fieldIndexes=e,this.parent=n,this.parentField=t}return e.prototype.change=function(e,t){void 0===t&&(t=!1);var n=this.fieldIndexes[e],r="number"==typeof n?n:e;t?t&&(this.changed=!0,this.changes.add(r),this.allChanges.delete(r)):(this.changed=!0,this.changes.add(r),this.allChanges.add(r)),this.parent&&this.parent.change(this.parentField)},e.prototype.mapIndex=function(e,t){"object"==typeof e&&(this.indexMap||(this.indexMap=new Map,this.indexChange=new Map),this.indexMap.set(e,t))},e.prototype.getIndex=function(e){return this.indexMap&&this.indexMap.get(e)},e.prototype.deleteIndex=function(e){"object"==typeof e&&(this.deletedKeys[this.indexMap.get(e)]=!0,this.indexMap.delete(e))},e.prototype.isDeleted=function(e){return void 0!==this.deletedKeys[e]},e.prototype.mapIndexChange=function(e,t){"object"!=typeof e||this.indexChange.has(e)||this.indexChange.set(e,t)},e.prototype.getIndexChange=function(e){return this.indexChange&&this.indexChange.get(e)},e.prototype.deleteIndexChange=function(e){"object"==typeof e&&this.indexChange.delete(e)},e.prototype.changeAll=function(e){if(e instanceof r.Schema){var t=e._schema;for(var n in t)(e[n]instanceof r.Schema||e[n]instanceof o.ArraySchema||e[n]instanceof i.MapSchema)&&!e[n].$changes.parent.parent&&(e[n].$changes.parent=this),void 0!==e[n]&&this.change(n)}else for(var s=0,a=Object.keys(e);s<a.length;s++){var c=a[s];void 0!==e[c]&&this.change(c)}},e.prototype.discard=function(){this.changed=!1,this.changes.clear(),this.deletedKeys={},this.indexChange&&this.indexChange.clear()},e.prototype.clone=function(){return new e(this.fieldIndexes,this.parentField,void 0)},e}();t.ChangeTree=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineTypes=t.deprecated=t.filter=t.type=t.globalContext=t.Context=void 0;var r=n(16),o=n(3),i=function(){function e(){this.types={},this.schemas=new Map}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e){e._typeid=this.schemas.size,this.types[e._typeid]=e,this.schemas.set(e,e._typeid)},e}();function s(e,n){return void 0===n&&(n=t.globalContext),function(t,i){var s=t.constructor;s._context=n,n.has(s)||(n.add(s),s._schema=Object.assign({},s._schema||{}),s._indexes=Object.assign({},s._indexes||{}),s._fieldsByIndex=Object.assign({},s._fieldsByIndex||{}),s._descriptors=Object.assign({},s._descriptors||{}),s._deprecated=Object.assign({},s._deprecated||{}));var a=Object.keys(s._schema).length;if(s._fieldsByIndex[a]=i,s._indexes[i]=a,s._schema[i]=e,!s._descriptors[i]){var c=Array.isArray(e),u=!c&&e.map,h="function"==typeof s._schema[i],l="_"+i;s._descriptors[l]={enumerable:!1,configurable:!1,writable:!0},s._descriptors[i]={get:function(){return this[l]},set:function(e){if((c||u)&&(e=new Proxy(e,{get:function(e,t){return e[t]},set:function(e,t,n){if("length"!==t&&0!==t.indexOf("$")){var i=c?Number(t):String(t);if(!e.$sorting){var s=e.$changes.getIndex(n);void 0!==s&&e.$changes.mapIndexChange(n,s),e.$changes.mapIndex(n,i)}n instanceof o.Schema?n.$changes.parent||(n.$changes=new r.ChangeTree(n._indexes,i,e.$changes),n.$changes.changeAll(n)):e[t]=n,e.$changes.change(i)}else e[t];return e[t]=n,!0},deleteProperty:function(e,t){var n=e[t];u&&void 0!==n&&(e.$changes.deleteIndex(n),e.$changes.deleteIndexChange(n),n.$changes&&delete n.$changes.parent),delete e[t];var r=c?Number(t):String(t);return e.$changes.change(r,!0),!0}})),e!==this[l])if(this[l]=e,c){this.$changes.change(i),e.$changes=new r.ChangeTree({},i,this.$changes);for(var t=0;t<e.length;t++)e[t]instanceof o.Schema&&(e[t].$changes=new r.ChangeTree(e[t]._indexes,t,e.$changes),e[t].$changes.changeAll(e[t])),e.$changes.mapIndex(e[t],t),e.$changes.change(t)}else if(u)for(var n in e.$changes=new r.ChangeTree({},i,this.$changes),this.$changes.change(i),e)e[n]instanceof o.Schema&&(e[n].$changes=new r.ChangeTree(e[n]._indexes,n,e.$changes),e[n].$changes.changeAll(e[n])),e.$changes.mapIndex(e[n],n),e.$changes.change(n);else h?(this.$changes.change(i),e&&(e.$changes=new r.ChangeTree(e._indexes,i,this.$changes),e.$changes.changeAll(e))):this.$changes.change(i)},enumerable:!0,configurable:!0}}}}t.Context=i,t.globalContext=new i,t.type=s,t.filter=function(e){return function(t,n){var r=t.constructor;r._filters||(r._filters={}),r._filters[n]=e}},t.deprecated=function(e,n){return void 0===e&&(e=!0),void 0===n&&(n=t.globalContext),function(t,n){var r=t.constructor;r._deprecated[n]=!0,e&&(r._descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(e){},enumerable:!1,configurable:!0})}},t.defineTypes=function(e,n,r){for(var o in void 0===r&&(r=t.globalContext),n)s(n[o],r)(e.prototype,o);return e}},function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var o,i,s,a;if(u(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=h(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=f.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):v(o,o.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,h=v(c,u);for(n=0;n<u;++n)i(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,o,i,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){const{EventEmitter:r}=n(18),o=n(4);e.exports=class extends r{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new o("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}async safeEmitAsPromise(e,...t){return new Promise((n,r)=>{this.safeEmit(e,...t,n,r)})}}},function(e,t,n){const r=n(4),{generateRandomNumber:o}=n(56),i=new r("Message");e.exports=class{static parse(e){let t;const n={};try{t=JSON.parse(e)}catch(e){return void i.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(n.request=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");n.id=t.id,n.method=t.method,n.data=t.data||{}}else if(t.response){if(n.response=!0,"number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");n.id=t.id,t.ok?(n.ok=!0,n.data=t.data||{}):(n.ok=!1,n.errorCode=t.errorCode,n.errorReason=t.errorReason)}else{if(!t.notification)return void i.error("parse() | missing request/response field");if(n.notification=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");n.method=t.method,n.data=t.data||{}}return n}i.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:o(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,n){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:n}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteStream=t.LocalStream=t.Stream=t.VideoResolutions=void 0;const o=n(5),i=n(22);t.VideoResolutions={qvga:{width:{ideal:320},height:{ideal:180}},vga:{width:{ideal:640},height:{ideal:360}},shd:{width:{ideal:960},height:{ideal:540}},hd:{width:{ideal:1280},height:{ideal:720}},fhd:{width:{ideal:1920},height:{ideal:1090}}};class s extends MediaStream{static setDispatch(e){s.dispatch=e}get dispatch(){if(!s.dispatch)throw new Error("Dispatch not set.");return s.dispatch}}t.Stream=s;class a extends s{constructor(e,t){super(e),Object.setPrototypeOf(this,a.prototype),this.options=t}static getUserMedia(e={codec:"VP8",resolution:"hd",audio:!1,video:!1}){return r(this,void 0,void 0,(function*(){try{const n=yield navigator.mediaDevices.getUserMedia({audio:e.audio,video:e.video instanceof Object?Object.assign(Object.assign({},t.VideoResolutions[e.resolution]),e.video):!!e.video&&t.VideoResolutions[e.resolution]});return new a(n,e)}catch(e){return null}}))}static getDisplayMedia(e={codec:"VP8",resolution:"hd",audio:!1,video:!0}){return r(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.getDisplayMedia({video:!0});return new a(t,e)}))}getVideoConstraints(){return this.options.video instanceof Object?Object.assign(Object.assign({},t.VideoResolutions[this.options.resolution]),this.options.video):{video:this.options.video}}switchDevice(e,t){return r(this,void 0,void 0,(function*(){this.options=Object.assign(Object.assign({},this.options),{[e]:this.options[e]instanceof Object?Object.assign(Object.assign({},this.options[e]),{deviceId:t}):{deviceId:t}});const n=(yield navigator.mediaDevices.getUserMedia({[e]:"video"===e?Object.assign(Object.assign({},this.getVideoConstraints()),{deviceId:t}):{deviceId:t}})).getTracks()[0];let o;"audio"===e?o=this.getAudioTracks()[0]:"video"===e&&(o=this.getVideoTracks()[0]),this.addTrack(n),this.removeTrack(o),o.stop(),this.transport&&this.transport.getSenders().forEach(e=>r(this,void 0,void 0,(function*(){var t,r;(null===(t=null==e?void 0:e.track)||void 0===t?void 0:t.kind)===n.kind&&(null===(r=e.track)||void 0===r||r.stop(),e.replaceTrack(n))})))}))}mute(e){"audio"===e?this.getAudioTracks()[0].enabled=!1:"video"===e&&(this.getVideoTracks()[0].enabled=!1)}unmute(e){return r(this,void 0,void 0,(function*(){"audio"===e?this.getAudioTracks()[0].enabled=!0:"video"===e&&(this.getVideoTracks()[0].enabled=!0)}))}publish(e){return r(this,void 0,void 0,(function*(){const{bandwidth:t,codec:n}=this.options;let s=!0;this.transport=new i.default(n),this.getTracks().map(e=>this.transport.addTrack(e,this));const a=yield this.transport.createOffer({offerToReceiveVideo:!1,offerToReceiveAudio:!1});o.debug("Created offer => %o",a),this.transport.setLocalDescription(a),this.transport.onicecandidate=()=>r(this,void 0,void 0,(function*(){if(s){s=!1;const r=this.transport.localDescription;o.debug("Sending offer "+r);const i=yield this.dispatch.request("publish",{rid:e,jsep:r,options:{codec:n,bandwidth:Number(t)}});this.mid=i.mid,o.debug("Got answer => %o",null==i?void 0:i.jsep),yield this.transport.setRemoteDescription(null==i?void 0:i.jsep),this.rid=e}})),this.transport.onnegotiationneeded=()=>r(this,void 0,void 0,(function*(){o.info("negotiation needed")}))}))}unpublish(){return r(this,void 0,void 0,(function*(){if(!this.rid||!this.mid)throw new Error("Stream is not published.");return o.info("unpublish rid => %s, mid => %s",this.rid,this.mid),this.transport&&(this.transport.close(),delete this.transport),yield this.dispatch.request("unpublish",{rid:this.rid,mid:this.mid}).then(()=>{delete this.rid,delete this.mid})}))}}t.LocalStream=a;class c extends s{static getRemoteMedia(e,t,n){return r(this,void 0,void 0,(function*(){const s=Array.from(n.values()).flat(),a=s.map(e=>"audio"===e.type.toLowerCase()).includes(!0),u=s.map(e=>"video"===e.type.toLowerCase()).includes(!0);let h=!0;o.debug("Creating receiver => %s",t);const l=new i.default;a&&l.addTransceiver("audio"),u&&l.addTransceiver("video");const f=yield l.createOffer();o.debug("Created offer => %o",f),l.setLocalDescription(f),l.onnegotiationneeded=()=>{o.debug("negotiation needed")},l.onicecandidate=n=>r(this,void 0,void 0,(function*(){if(h){o.debug("Send offer"),h=!1;const n=l.localDescription,r=yield this.dispatch.request("subscribe",{rid:e,jsep:n,mid:t});o.info(`subscribe success => result(mid: ${r.mid})`),o.debug("Got answer => %o",null==r?void 0:r.jsep),yield l.setRemoteDescription(null==r?void 0:r.jsep)}}));const d=yield new Promise((e,t)=>r(this,void 0,void 0,(function*(){try{l.ontrack=({track:n,streams:r})=>{o.debug("on track called"),n.onunmute=()=>{r.length>0?e(r[0]):t(new Error("Not enough streams"))}}}catch(e){o.error("subscribe request error  => "+e),t(e)}}))),p=new c(d);return p.transport=l,p.mid=t,p.rid=e,p}))}constructor(e){super(e),Object.setPrototypeOf(this,c.prototype)}close(){if(!this.transport)throw new Error("Stream is not open.");this.transport&&(this.transport.close(),delete this.transport)}unsubscribe(){return r(this,void 0,void 0,(function*(){if(!this.transport)throw new Error("Stream is not subscribed.");return o.info("unsubscribe mid => %s",this.mid),this.close(),yield this.dispatch.request("unsubscribe",{mid:this.mid})}))}}t.RemoteStream=c},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(65),i=n(5);var s;!function(e){e[e.PCMU=0]="PCMU",e[e.PCMA=8]="PCMA",e[e.G722=9]="G722",e[e.Opus=111]="Opus",e[e.VP8=96]="VP8",e[e.VP9=98]="VP9",e[e.H264=102]="H264"}(s||(s={}));let a=(()=>{class e{constructor(t){if(!e.config)throw new Error("RTConfiguration not set.");this.pc=new RTCPeerConnection(e.config),this.rtp=t?function(e){switch(e){case"H264":return[{payload:s.H264,codec:"H264",rate:9e4}];case"VP8":return[{payload:s.VP8,codec:"VP8",rate:9e4}];case"VP9":return[{payload:s.VP9,codec:"VP9",rate:9e4}];default:return[]}}(t):null}static setRTCConfiguration(t){e.config=t}close(){this.pc.ontrack=null,this.pc.onicecandidate=null,this.pc.onnegotiationneeded=null,this.pc.getSenders().forEach(e=>this.pc.removeTrack(e)),this.pc.close()}addTrack(e,t){return this.pc.addTrack(e,t)}addTransceiver(e){this.pc.addTransceiver(e,{direction:"recvonly"})}removeTrack(e){this.pc.removeTrack(e)}getSenders(){return this.pc.getSenders()}setLocalDescription(e){this.pc.setLocalDescription(e)}setRemoteDescription(e){return this.pc.setRemoteDescription(e)}createOffer(e){return r(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer(e);if(!this.rtp)return t;const n=o.parse(t.sdp),r=n.media.findIndex(({type:e,ssrcGroups:t})=>"video"===e&&!!t);if(-1===r)return t;const{payload:s}=this.rtp[0];n.media[r].payloads=""+s,n.media[r].rtp=this.rtp;n.media[r].fmtp=[];const a=[{payload:s,type:"transport-cc",subtype:void 0},{payload:s,type:"ccm",subtype:"fir"},{payload:s,type:"nack",subtype:void 0},{payload:s,type:"nack",subtype:"pli"}];n.media[r].rtcpFb=a;const c=n.media[r].ssrcGroups[0].ssrcs,u=parseInt(c.split(" ")[0],10);return i.debug("ssrcs => %s, video %s",c,u),n.media[r].ssrcGroups=[],n.media[r].ssrcs=n.media[r].ssrcs.filter(e=>e.id===u),t.sdp=o.write(n),t}))}get localDescription(){return this.pc.localDescription}set onicecandidate(e){this.pc.onicecandidate=e}set onnegotiationneeded(e){this.pc.onnegotiationneeded=e}set ontrack(e){this.pc.ontrack=e}}return e.config={iceServers:[{urls:"stun:stun.stunprotocol.org:3478"}]},e})();t.default=a},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach((function(e){n[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaSerializer=t.FossilDeltaSerializer=t.registerSerializer=void 0,n(26);var r=n(27);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return r.Client}});var o=n(10);Object.defineProperty(t,"Protocol",{enumerable:!0,get:function(){return o.Protocol}}),Object.defineProperty(t,"ErrorCode",{enumerable:!0,get:function(){return o.ErrorCode}});var i=n(7);Object.defineProperty(t,"Room",{enumerable:!0,get:function(){return i.Room}});var s=n(14);Object.defineProperty(t,"Auth",{enumerable:!0,get:function(){return s.Auth}}),Object.defineProperty(t,"Platform",{enumerable:!0,get:function(){return s.Platform}});var a=n(39);Object.defineProperty(t,"FossilDeltaSerializer",{enumerable:!0,get:function(){return a.FossilDeltaSerializer}});var c=n(44);Object.defineProperty(t,"SchemaSerializer",{enumerable:!0,get:function(){return c.SchemaSerializer}});var u=n(9);Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return u.registerSerializer}}),u.registerSerializer("fossil-delta",a.FossilDeltaSerializer),u.registerSerializer("schema",c.SchemaSerializer)},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var r=n(24),o=n(2);function i(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(o,i){try{var s=t[o](i),a=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(a).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(a)}("next")}))}}const s=0,a=1,c=2;class u{constructor(){this.app="default",this.roomName="hubs",this.room=null,this.roomData=null,this.userData=null,this.players={},this.streams=null,this.pendingStreamRequests=null,this.timeOffsets=[],this.serverTimeRequests=0,this.avgTimeOffset=0,this.blockedClients=new Map,this.frozenUpdates=new Map,this.options={createRoom:!0,useIon:!0,startLocalStream:!1,mediaOptions:{audio:!0,video:!1,selectedAudioDevice:"",selectedVideoDevice:"",resolution:"vga",bandwidth:1024,codec:"VP9"}}}setServerUrl(e){this.colyseusUrl=e[0],this.ionUrl=e[1]}setApp(e){this.app=e}setRoom(e){this.roomId=e}setOptions(e){this.options=Object.assign(this.options,e)}setWebRtcOptions(e){this.options.mediaOptions=Object.assign(this.options.mediaOptions,e)}setServerConnectListeners(e,t){this.connectSuccess=e,this.connectFailure=t}setRoomOccupantListener(e){this.occupantListener=e}setDataChannelListeners(e,t,n){this.openListener=e,this.closedListener=t,this.messageListener=n}connect(){this.colyseusUrl&&"/"!==this.colyseusUrl||("https:"===location.protocol?(this.colyseusUrl="wss://"+location.host+":2567",this.ionUrl="wss://"+location.host+":8443"):(this.colyseusUrl="ws://"+location.host+":2567",this.ionUrl="ws://"+location.host+":8443")),NAF.log.write("Attempting to connect to colyseus");const e=new Promise((e,t)=>{this.colyseus=new r.Client(this.colyseusUrl),this.joinRoom().then(e).catch(t)});return this.options.useIon&&e.then(()=>{const e={url:this.ionUrl,loglevel:"trace"};this.ion=new o.Client(e),this.ion.on("transport-open",this.onIonOpen.bind(this)),this.ion.on("transport-closed",this.onIonClosed.bind(this)),this.streams={},this.pendingStreamRequests={}}),Promise.all([e,this.updateTimeOffset()])}joinRoom(){NAF.log.write("Joining room",this.roomName,this.roomId);const e={roomId:this.roomId};return this.options.createRoom?this.colyseus.joinOrCreate(this.roomName,e).then(this.onJoin.bind(this)).catch(this.onJoinError.bind(this)):this.colyseus.join(this.roomName,e).then(this.onJoin.bind(this)).catch(this.onJoinError.bind(this))}onJoin(e){this.room=e,e.onMessage("roomData",this.onRoomData.bind(this)),e.onMessage("userData",this.onUserData.bind(this)),e.onMessage("naf",this.onNaf.bind(this)),e.onMessage("chat",this.onChat.bind(this)),e.onStateChange.once(this.onInitialState.bind(this)),e.onStateChange(this.onStateChange.bind(this)),e.state.players&&(this.players[this.sessionId]={},e.state.players.onAdd=this.onAddPlayer.bind(this),e.state.players.onRemove=this.onRemovePlayer.bind(this)),this.connectSuccess(this.sessionId),this.ionState>=a&&this.joinIon()}onJoinError(e){this.connectFailure();document.body.dispatchEvent(new CustomEvent("connect_error",{detail:{reason:"join_denied"}}))}get sessionId(){return this.room.sessionId}get player(){this.players[this.sessionId]}get scene(){return this.roomData.scene}get sceneId(){return this.roomData.scene.scene_id}onRoomData(e){this.roomData=e;const t=e;document.body.dispatchEvent(new CustomEvent("room_data",{detail:t}))}onUserData(e){this.userData=e;const t=e;document.body.dispatchEvent(new CustomEvent("user_data",{detail:t}))}getAvatar(e){const t=this.roomData.avatars.entries;for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n]}getAvatarSrc(e){const t=this.getAvatar(e);return t&&t.gltfs&&t.gltfs.avatar}getScene(e){const t=this.roomData.scenes.entries;for(let n=0;n<t.length;n++)if(t[n].id===e)return t[n]}checkSameScene(e){return this.roomData&&(this.roomData.scene.scene_id===e.sceneId||this.roomData.scene.scene_id===this.roomData.scenes.entries[0].id&&"lobby"===e.sceneId)}updateScene(e){if(e===this.roomData.scene.scene_id)return;const t=this.getScene(e);t&&(Object.keys(t).forEach(e=>this.roomData.scene[e]=t[e]),this.roomData.scene.model_url=t.url,this.roomData.scene.scene_id=t.id,this.roomData.scene.objects_url=t.objects_url,document.body.dispatchEvent(new CustomEvent("change_scene")))}canEnterRoom(e){if(!e)return!1;return Object.values(this.players).reduce((e,{presence:t})=>e+("room"===t.presence||t.entering?1:0),0)<(void 0!==e.room_size?e.room_size:24)}onNaf(e){this.onData(e.sessionId,e.type,e.data)}onChat(e){const t={sessionId:e.sessionId,message:e.message,from:e.from};document.body.dispatchEvent(new CustomEvent("chat",{detail:t}))}onData(e,t,n,r){this.frozen?this.storeMessage(n):this.messageListener(e,t,n,r)}sendChatMsg(e){this.room.send("chat",e)}onInitialState(e){this.state=e}onStateChange(e){}onAddPlayer(e,t){this.players[t]=e,e.onChange=e=>{e.forEach(e=>{switch(e.field){case"profile":this.onChangeProfile(e.value,e.previousValue,t);break;case"presence":this.onChangePresence(e.value,e.previousValue,t)}})},(t===this.sessionId||this.checkSameScene(e.presence))&&this.openListener(t),this.occupantListener&&this.occupantListener(this.players),t===this.sessionId&&(e.profile.displayName=window.APP.store.state.profile.displayName,this.update({profile:{displayName:e.profile.displayName}}));const n={sessionId:t,player:e};document.body.dispatchEvent(new CustomEvent("player_added",{detail:n}))}onRemovePlayer(e,t){this.players[t].onChange=void 0,delete this.players[t],this.closedListener(t),this.occupantListener&&this.occupantListener(this.players);const n={sessionId:t,player:e};document.body.dispatchEvent(new CustomEvent("player_removed",{detail:n}))}onChangeProfile(e,t,n){const r={sessionId:n,profile:e,previous:t};document.body.dispatchEvent(new CustomEvent("profile_updated",{detail:r}))}onChangePresence(e,t,n){if(n===this.sessionId)for(let e in this.players)e!==n&&(this.checkSameScene(this.players[e].presence)?this.openListener(e):this.closedListener(e));else this.checkSameScene(e)?this.openListener(n):this.closedListener(n);const r={sessionId:n,presence:e,previous:t};document.body.dispatchEvent(new CustomEvent("presence_updated",{detail:r}))}signIn(e){this.room.send("sign_in",e)}update(e){this.room.send("update",e)}sendEntering(){this.update({presence:{entering:!0}})}sendEnteringCancelled(){this.update({presence:{entering:!1}})}sendEntered(){const e={presence:"room",sceneId:this.roomData.scene.scene_id,entering:!1};this.update({presence:e})}sendObjectSpawned(e){}pin(e,t,n,r,o){this.room.send("pin",{networkId:e,gltfNode:t,fileId:n})}unpin(e,t){this.room.send("unpin",{networkId:e,fileId:t})}onIonOpen(){this.ionState=a,this.options.startLocalStream&&this.startLocalStream(),this.joinIon()}onIonClosed(){this.ionState=s}joinIon(){var e=this;return i((function*(){e.ion.on("peer-join",e.onPeerJoin.bind(e)),e.ion.on("peer-leave",e.onPeerLeave.bind(e)),e.ion.on("stream-add",e.onStreamAdd.bind(e)),e.ion.on("stream-remove",e.onStreamRemove.bind(e)),e.ion.on("broadcast",e.onBroadcast.bind(e)),yield e.ion.join(e.room.id,{name:e.sessionId}),e.ionState=c,e.localStream&&e.ion.publish(e.localStream)}))()}onPeerJoin(e,t){NAF.log.write("Peer join ",e,t)}onPeerLeave(e){NAF.log.write("Peer leave ",e)}onStreamAdd(e,t){var n=this;return i((function*(){n.ion&&(yield n.subscribe(e,t))}))()}onStreamRemove(e){}onBroadcast(e,t,n){NAF.log.write("Ion broadcast ",e,t,n)}subscribe(e,t){var n=this;return i((function*(){const r=t.name,o=yield n.ion.subscribe(e);o.info=t,n.setMediaStream(r,o)}))()}unsubscribe(e){var t=this;return i((function*(){const n=e.info.name;yield e.unsubscribe(),delete t.streams[n]}))()}shouldStartConnectionTo(e){return!1}getConnectStatus(e){return this.streams[e]?NAF.adapters.IS_CONNECTED:NAF.adapters.NOT_CONNECTED}sendData(e,t,n){this.sendDataGuaranteed(e,t,n)}sendDataGuaranteed(e,t,n){this.room?this.room.send("naf",{to:e,type:t,data:n}):NAF.log.warn("Room not joined yet")}broadcastData(e,t){this.broadcastDataGuaranteed(e,t)}broadcastDataGuaranteed(e,t){this.room?this.room.send("naf",{type:e,data:t}):NAF.log.warn("Room not joined yet")}getMediaStream(e,t="audio"){if(this.streams[e])return NAF.log.write(`Already had ${t} for ${e}`),Promise.resolve(this.streams[e][t]);if(NAF.log.write(`Waiting on ${t} for ${e}`),!this.pendingStreamRequests[e]){this.pendingStreamRequests[e]={};const t=new Promise((t,n)=>{this.pendingStreamRequests[e].audio={resolve:t,reject:n}}),n=new Promise((t,n)=>{this.pendingStreamRequests[e].video={resolve:t,reject:n}});this.pendingStreamRequests[e].audio.promise=t,this.pendingStreamRequests[e].video.promise=n,t.catch(t=>console.warn(e+" getMediaStream Audio Error",t)),n.catch(t=>console.warn(e+" getMediaStream Video Error",t))}return this.pendingStreamRequests[e][t].promise}setMediaStream(e,t){if(t){const n=new MediaStream;try{t.getAudioTracks().forEach(e=>n.addTrack(e))}catch(t){NAF.log.write(e+" setMediaStream Audio Error",t)}const r=new MediaStream;try{t.getVideoTracks().forEach(e=>r.addTrack(e))}catch(t){NAF.log.write(e+" setMediaStream Video Error",t)}this.streams[e]={audio:n,video:r},this.pendingStreamRequests[e]&&(this.pendingStreamRequests[e].audio.resolve(n),this.pendingStreamRequests[e].video.resolve(r),delete this.pendingStreamRequests[e])}else delete this.streams[e];const n={stream:t,sessionId:e};document.body.dispatchEvent(new CustomEvent("set_media_stream",{detail:n}))}setLocalMediaStream(e){var t=this;return i((function*(){if(t.localStream){let e=t.localStream.getTracks();for(let t=0,n=e.length;t<n;t++)yield e[t].stop();yield t.localStream.unpublish()}e&&(e instanceof o.LocalStream||(e=new o.LocalStream(e,t.options.mediaOptions))),t.localStream=e,t.setMediaStream(t.sessionId,t.localStream),t.localStream&&t.ionState>=c&&(yield t.ion.publish(t.localStream))}))()}startLocalStream(){var e=this;return i((function*(){yield e.setLocalMediaStream(null),yield e.setLocalMediaStream(yield o.LocalStream.getUserMedia(e.options.mediaOptions))}))()}enableMicrophone(e){this.localStream&&(e?this.localStream.unmute("audio"):this.localStream.mute("audio"))}toggleFreeze(){this.frozen?this.unfreeze():this.freeze()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1,this.flushPendingUpdates()}flushPendingUpdates(){for(const[e,t]of this.frozenUpdates){let n=this.getPendingData(e,t);if(!n)continue;const r="um"===t.dataType?"u":t.dataType;this.messageListener(null,r,n,t.source)}this.frozenUpdates.clear()}getPendingData(e,t){if(!t)return null;let n="um"===t.dataType?this.dataForUpdateMultiMessage(e,t):t.data;return n.owner&&!this.players[n.owner]||n.owner&&this.blockedClients.has(n.owner)?null:n}storeMessage(e){if("um"===e.dataType)for(let t=0,n=e.data.d.length;t<n;t++)this.storeSingleMessage(e,t);else this.storeSingleMessage(e)}storeSingleMessage(e,t){const n=void 0!==t?e.data.d[t]:e.data,r=e.dataType,o=(e.source,n.networkId);if(this.frozenUpdates.has(o)){const t=this.frozenUpdates.get(o),i="um"===t.dataType?this.dataForUpdateMultiMessage(o,t):t.data,s=n.lastOwnerTime<i.lastOwnerTime,a=n.lastOwnerTime===i.lastOwnerTime;if(s||a&&i.owner>n.owner)return;if("r"===r){i&&i.isFirstSync?this.frozenUpdates.delete(o):this.frozenUpdates.set(o,e)}else i.components&&n.components&&Object.assign(i.components,n.components)}else this.frozenUpdates.set(o,e)}dataForUpdateMultiMessage(e,t){for(let n=0,r=t.data.d.length;n<r;n++){const r=t.data.d[n];if(r.networkId===e)return r}return null}block(e){this.room.send({kind:"block",whom:e}),this.blockedClients.set(e,!0);const t={clientId:e};document.body.dispatchEvent(new CustomEvent("blocked",{detail:t}))}unblock(e){this.room.send({kind:"unblock",whom:e}),this.blockedClients.delete(e);const t={clientId:e};document.body.dispatchEvent(new CustomEvent("unblocked",{detail:t}))}disconnect(){this.ion.leave(),this.streams={},this.pendingStreamRequests={},this.room.state.players&&(this.room.state.players.onAdd=void 0,this.room.state.players.onRemove=void 0,this.room.state.players.onChange=void 0),this.room.removeAllListeners(),this.room.leave(!1),this.room=null}isDisconnected(){return null===this.room}setReconnectionListeners(e,t,n){this.onReconnecting=e,this.onReconnected=t,this.onReconnectionError=n}updateTimeOffset(){var e=this;return i((function*(){if(e.isDisconnected())return;const t=Date.now(),n=yield fetch(document.location.href,{method:"HEAD",cache:"no-cache"}),r=new Date(n.headers.get("Date")).getTime()+500,o=Date.now(),i=r+(o-t)/2-o;e.serverTimeRequests++,e.serverTimeRequests<=10?e.timeOffsets.push(i):e.timeOffsets[e.serverTimeRequests%10]=i,e.avgTimeOffset=e.timeOffsets.reduce((function(e,t){return e+t}),0)/e.timeOffsets.length,e.serverTimeRequests>10?(NAF.log.write(`new server time offset: ${e.avgTimeOffset}ms`),setTimeout((function(){return e.updateTimeOffset()}),3e5)):e.updateTimeOffset()}))()}getServerTime(){return Date.now()+this.avgTimeOffset}}NAF.adapters.register("colyseus-ion",u)},function(e,t){ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer})},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.MatchMakeError=void 0;var a=n(6),c=n(28),u=n(7),h=n(14),l=n(38),f=function(e){function t(n,r){var o=e.call(this,n)||this;return o.code=r,Object.setPrototypeOf(o,t.prototype),o}return o(t,e),t}(Error);t.MatchMakeError=f;var d=function(){function e(e){void 0===e&&(e=location.protocol.replace("http","ws")+"//"+location.hostname+(location.port&&":"+location.port)),this.endpoint=e,this.auth=new h.Auth(this.endpoint),this.push=new l.Push(this.endpoint)}return e.prototype.joinOrCreate=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.create=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.join=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.joinById=function(e,t,n){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.reconnect=function(e,t,n){return i(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:t},n)];case 1:return[2,r.sent()]}}))}))},e.prototype.getAvailableRooms=function(e){return void 0===e&&(e=""),i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+e,[4,a.get(t,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}}))}))},e.prototype.consumeSeatReservation=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return(n=this.createRoom(e.room.name,t)).id=e.room.roomId,n.sessionId=e.sessionId,n.connect(this.buildEndpoint(e.room,{sessionId:n.sessionId})),[2,new Promise((function(e,t){var r=function(e,n){return t(new c.ServerError(e,n))};n.onError.once(r),n.onJoin.once((function(){n.onError.remove(r),e(n)}))}))]}))}))},e.prototype.createMatchMakeRequest=function(e,t,n,r){return void 0===n&&(n={}),i(this,void 0,void 0,(function(){var o,i;return s(this,(function(s){switch(s.label){case 0:return o=this.endpoint.replace("ws","http")+"/matchmake/"+e+"/"+t,this.auth.hasToken&&(n.token=this.auth.token),[4,a.post(o,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((i=s.sent().data).error)throw new f(i.error,i.code);return[2,this.consumeSeatReservation(i,r)]}}))}))},e.prototype.createRoom=function(e,t){return new u.Room(e,t)},e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(r+"="+t[r]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+n.join("&")},e}();t.Client=d},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=void 0;var i=function(e){function t(t,n){var r=e.call(this,n)||this;return r.name="ServerError",r.code=t,r}return o(t,e),t}(Error);t.ServerError=i},function(e,t,n){"use strict";function r(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}Object.defineProperty(t,"__esModule",{value:!0}),r.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},r.prototype._map=function(e){for(var t={},n=0;n<e;n++)t[this._parse()]=this._parse();return t},r.prototype._str=function(e){var t=function(e,t,n){for(var r="",o=0,i=t,s=t+n;i<s;i++){var a=e.getUint8(i);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));(o=(7&a)<<18|(63&e.getUint8(++i))<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0)>=65536?(o-=65536,r+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):r+=String.fromCharCode(o)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0);else r+=String.fromCharCode((31&a)<<6|63&e.getUint8(++i));else r+=String.fromCharCode(a)}return r}(this._view,this._offset,e);return this._offset+=e,t},r.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},r.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,r=0,o=0,i=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,[r,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return o=this._view.getUint32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,o+i;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return o=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,o+i;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(o=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(o+i)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},t.default=function(e,t){void 0===t&&(t=0);var n=new r(e,t),o=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return o}},function(e,t,n){"use strict";function r(e,t,n){for(var r=0,o=0,i=n.length;o<i;o++)(r=n.charCodeAt(o))<128?e.setUint8(t++,r):r<2048?(e.setUint8(t++,192|r>>6),e.setUint8(t++,128|63&r)):r<55296||r>=57344?(e.setUint8(t++,224|r>>12),e.setUint8(t++,128|r>>6&63),e.setUint8(t++,128|63&r)):(o++,r=65536+((1023&r)<<10|1023&n.charCodeAt(o)),e.setUint8(t++,240|r>>18),e.setUint8(t++,128|r>>12&63),e.setUint8(t++,128|r>>6&63),e.setUint8(t++,128|63&r))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=[],n=[],o=function e(t,n,r){var o=typeof r,i=0,s=0,a=0,c=0,u=0,h=0;if("string"===o){if((u=function(e){for(var t=0,n=0,r=0,o=e.length;r<o;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(r))<32)t.push(160|u),h=1;else if(u<256)t.push(217,u),h=2;else if(u<65536)t.push(218,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("String too long");t.push(219,u>>24,u>>16,u>>8,u),h=5}return n.push({_str:r,_length:u,_offset:t.length}),h+u}if("number"===o)return Math.floor(r)===r&&isFinite(r)?r>=0?r<128?(t.push(r),1):r<256?(t.push(204,r),2):r<65536?(t.push(205,r>>8,r),3):r<4294967296?(t.push(206,r>>24,r>>16,r>>8,r),5):(a=r/Math.pow(2,32)>>0,c=r>>>0,t.push(207,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),9):r>=-32?(t.push(r),1):r>=-128?(t.push(208,r),2):r>=-32768?(t.push(209,r>>8,r),3):r>=-2147483648?(t.push(210,r>>24,r>>16,r>>8,r),5):(a=Math.floor(r/Math.pow(2,32)),c=r>>>0,t.push(211,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),9):(t.push(203),n.push({_float:r,_length:8,_offset:t.length}),9);if("object"===o){if(null===r)return t.push(192),1;if(Array.isArray(r)){if((u=r.length)<16)t.push(144|u),h=1;else if(u<65536)t.push(220,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("Array too large");t.push(221,u>>24,u>>16,u>>8,u),h=5}for(i=0;i<u;i++)h+=e(t,n,r[i]);return h}if(r instanceof Date){var l=r.getTime();return a=Math.floor(l/Math.pow(2,32)),c=l>>>0,t.push(215,0,a>>24,a>>16,a>>8,a,c>>24,c>>16,c>>8,c),10}if(r instanceof ArrayBuffer){if((u=r.byteLength)<256)t.push(196,u),h=2;else if(u<65536)t.push(197,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("Buffer too large");t.push(198,u>>24,u>>16,u>>8,u),h=5}return n.push({_bin:r,_length:u,_offset:t.length}),h+u}if("function"==typeof r.toJSON)return e(t,n,r.toJSON());var f=[],d="",p=Object.keys(r);for(i=0,s=p.length;i<s;i++)"function"!=typeof r[d=p[i]]&&f.push(d);if((u=f.length)<16)t.push(128|u),h=1;else if(u<65536)t.push(222,u>>8,u),h=3;else{if(!(u<4294967296))throw new Error("Object too large");t.push(223,u>>24,u>>16,u>>8,u),h=5}for(i=0;i<u;i++)h+=e(t,n,d=f[i]),h+=e(t,n,r[d]);return h}if("boolean"===o)return t.push(r?195:194),1;if("undefined"===o)return t.push(212,0,0),3;throw new Error("Could not encode")}(t,n,e),i=new ArrayBuffer(o),s=new DataView(i),a=0,c=0,u=-1;n.length>0&&(u=n[0]._offset);for(var h,l=0,f=0,d=0,p=t.length;d<p;d++)if(s.setUint8(c+d,t[d]),d+1===u){if(l=(h=n[a])._length,f=c+u,h._bin)for(var m=new Uint8Array(h._bin),v=0;v<l;v++)s.setUint8(f+v,m[v]);else h._str?r(s,f,h._str):void 0!==h._float&&s.setFloat64(f,h._float);c+=l,n[++a]&&(u=n[a]._offset)}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return void 0===t&&(t=!1),this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))},e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}();t.EventEmitter=r,t.createSignal=function(){var e=new r;function t(t){return e.register(t,null===this)}return t.once=function(t){var n=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];t.apply(void 0,r),e.remove(n)};e.register(n)},t.remove=function(t){return e.remove(t)},t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)},t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)},t.clear=function(){return e.clear()},t}},function(e,t,n){"use strict";n.r(t),n.d(t,"createNanoEvents",(function(){return r}));let r=()=>({events:{},emit(e,...t){for(let n of this.events[e]||[])n(...t)},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=this.events[e].filter(e=>e!==t)}})},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;var s=i(n(34)),a=function(e){function t(t,n){void 0===n&&(n=!0);var r=e.call(this,t,void 0,{connect:n})||this;return r._enqueuedCalls=[],r}return o(t,e),t.prototype.onOpenCallback=function(t){if(e.prototype.onOpenCallback.call(this),this.binaryType="arraybuffer",this._enqueuedCalls.length>0){for(var n=0,r=this._enqueuedCalls;n<r.length;n++){var o=r[n],i=o[0],s=o[1];this[i].apply(this,s)}this._enqueuedCalls=[]}},t.prototype.send=function(t){if(this.ws.readyState===s.default.OPEN){if(t instanceof ArrayBuffer)return e.prototype.send.call(this,t);if(Array.isArray(t))return e.prototype.send.call(this,new Uint8Array(t).buffer)}else this._enqueuedCalls.push(["send",[t]])},t}(s.default);t.Connection=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(35).createBackoff,s="undefined"!=typeof WebSocket?WebSocket:n(36),a=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o(this,e),this.url=t,this.protocols=n,this.reconnectEnabled=!0,this.listeners={},this.backoff=i(r.backoff||"exponential",r),this.backoff.onReady=this.onBackoffReady.bind(this),(void 0===r.connect||r.connect)&&this.open()}return r(e,[{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isReconnect=e;var t=this.ws&&this.ws.binaryType;this.ws=new s(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),t&&(this.ws.binaryType=t)}},{key:"onBackoffReady",value:function(e,t){this.open(!0)}},{key:"onCloseCallback",value:function(e){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&e.code<3e3&&this.backoff.backoff()}},{key:"onErrorCallback",value:function(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}},{key:"onMessageCallback",value:function(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}},{key:"onOpenCallback",value:function(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}},{key:"close",value:function(e,t){void 0===e&&(e=1e3),this.reconnectEnabled=!1,this.ws.close(e,t)}},{key:"send",value:function(e){this.ws.send(e)}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(e){this.ws.binaryType=e}},{key:"extensions",get:function(){return this.ws.extensions},set:function(e){this.ws.extensions=e}},{key:"protocol",get:function(){return this.ws.protocol},set:function(e){this.ws.protocol=e}},{key:"onclose",set:function(e){this.listeners.onclose=e},get:function(){return this.listeners.onclose}},{key:"onerror",set:function(e){this.listeners.onerror=e},get:function(){return this.listeners.onerror}},{key:"onmessage",set:function(e){this.listeners.onmessage=e},get:function(){return this.listeners.onmessage}},{key:"onopen",set:function(e){this.listeners.onopen=e},get:function(){return this.listeners.onopen}},{key:"onreconnect",set:function(e){this.listeners.onreconnect=e},get:function(){return this.listeners.onreconnect}}]),e}();a.CONNECTING=s.CONNECTING,a.OPEN=s.OPEN,a.CLOSING=s.CLOSING,a.CLOSED=s.CLOSED,t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBackoff=function(e,t){return new o(r[e],t)};var r={exponential:function(e,t){return Math.floor(Math.random()*Math.pow(2,e)*t)},fibonacci:function(e,t){if(e>(r=1))for(var n=1,r=2,o=2;o<e;o++){var i=n+r;n=r,r=i}return Math.floor(Math.random()*r*t)}};function o(e,t){this.func=e,this.attempts=0,this.delay=void 0!==t.initialDelay?t.initialDelay:100}o.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},function(e,t){},function(e,t,n){"use strict";var r;function o(){return r||(r="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getItem=t.removeItem=t.setItem=void 0,t.setItem=function(e,t){o().setItem(e,t)},t.removeItem=function(e){o().removeItem(e)},t.getItem=function(e,t){var n=o().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((function(e){return t(e)})):t(n)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Push=void 0;var i=function(){function e(e){this.endpoint=e.replace("ws","http")}return e.prototype.register=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.check(),[4,this.registerServiceWorker()];case 1:return e.sent(),[4,this.requestNotificationPermission()];case 2:return e.sent(),[2]}}))}))},e.prototype.registerServiceWorker=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,navigator.serviceWorker.register(this.endpoint+"/push")];case 1:return[2,e.sent()]}}))}))},e.prototype.requestNotificationPermission=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,window.Notification.requestPermission()];case 1:if("granted"!==e.sent())throw new Error("Permission not granted for Notification");return[2]}}))}))},e.prototype.check=function(){if(!("serviceWorker"in navigator))throw new Error("No Service Worker support!");if(!("PushManager"in window))throw new Error("No Push API Support!")},e}();t.Push=i},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FossilDeltaSerializer=void 0;var s=n(40),a=i(n(43)),c=i(n(8)),u=function(){function e(){this.api=new s.StateContainer({})}return e.prototype.getState=function(){return this.api.state},e.prototype.setState=function(e){this.previousState=new Uint8Array(e),this.api.set(c.decode(this.previousState))},e.prototype.patch=function(e){this.previousState=new Uint8Array(a.apply(this.previousState,e)),this.api.set(c.decode(this.previousState))},e.prototype.teardown=function(){this.api.removeAllListeners()},e}();t.FossilDeltaSerializer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41);t.StateContainer=r.StateContainer},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(42),o=function(){function e(e){this.listeners=[],this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/},this.state=e,this.reset()}return e.prototype.set=function(e){var t=r.compare(this.state,e);return this.state=e,this.checkPatches(t,this.listeners,this.defaultListener),t},e.prototype.registerPlaceholder=function(e,t){this.matcherPlaceholders[e]=t},e.prototype.listen=function(e,t,n){var o,i=this;"function"==typeof e?(o=[],t=e):o=e.split("/"),t.length>1&&console.warn(".listen() accepts only one parameter.");var s={callback:t,rawRules:o,rules:o.map((function(e){return"string"==typeof e?0===e.indexOf(":")?i.matcherPlaceholders[e]||i.matcherPlaceholders[":*"]:new RegExp("^"+e+"$"):e}))};return 0===o.length?this.defaultListener=s:this.listeners.push(s),n&&this.checkPatches(r.compare({},this.state),[s]),s},e.prototype.removeListener=function(e){for(var t=this.listeners.length-1;t>=0;t--)this.listeners[t]===e&&this.listeners.splice(t,1)},e.prototype.removeAllListeners=function(){this.reset()},e.prototype.checkPatches=function(e,t,n){for(var r=0,o=t.length;r<o;r++)for(var i=t[r],s=e.length-1;s>=0;s--){var a=i&&this.getPathVariables(e[s],i);a&&(i.callback({path:a,rawPath:e[s].path,operation:e[s].operation,value:e[s].value}),e[s].matched=!0)}if(n)for(s=e.length-1;s>=0;s--)e[s].matched||n.callback(e[s])},e.prototype.getPathVariables=function(e,t){if(e.path.length!==t.rules.length)return!1;for(var n={},r=0,o=t.rules.length;r<o;r++){var i=e.path[r].match(t.rules[r]);if(!i||0===i.length||i.length>2)return!1;":"===t.rawRules[r].substr(0,1)&&(n[t.rawRules[r].substr(1)]=i[1])}return n},e.prototype.reset=function(){this.listeners=[]},e}();t.StateContainer=o},function(e,t,n){"use strict";function r(e,t){var n=e.slice();return n.push(t),n}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(o);return r}Object.defineProperty(t,"__esModule",{value:!0}),t.compare=function(e,t){var n=[];return function e(t,n,i,s){for(var a=o(n),c=o(t),u=!1,h=c.length-1;h>=0;h--){var l=c[h],f=t[l];if(!n.hasOwnProperty(l)||void 0===n[l]&&void 0!==f&&!1===Array.isArray(n))i.push({operation:"remove",path:r(s,l)}),u=!0;else{var d=n[l];"object"==typeof f&&null!=f&&"object"==typeof d&&null!=d?e(f,d,i,r(s,l)):f!==d&&i.push({operation:"replace",path:r(s,l),value:d,previousValue:f})}}if(!u&&a.length==c.length)return;for(h=a.length-1;h>=0;h--){l=a[h];if(!t.hasOwnProperty(l)&&void 0!==n[l]){d=n[l];var p=r(s,l);"object"==typeof d&&null!=d&&e({},d,i,p),i.push({operation:"add",path:p,value:d})}}}(e,t,n,[]),n}},function(e,t,n){var r,o;r=this,o=function(){"use strict";var e={};function t(){this.a=0,this.b=0,this.i=0,this.z=new Array(16)}t.prototype.init=function(e,t){var n,r,o=0,i=0;for(n=0;n<16;n++)o=o+(r=e[t+n])&65535,i=i+(16-n)*r&65535,this.z[n]=r;this.a=65535&o,this.b=65535&i,this.i=0},t.prototype.next=function(e){var t=this.z[this.i];this.z[this.i]=e,this.i=this.i+1&15,this.a=this.a-t+e&65535,this.b=this.b-16*t+this.a&65535},t.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map((function(e){return e.charCodeAt(0)})),r=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];function o(e){this.a=e,this.pos=0}function i(){this.a=[]}function s(e){var t,n;for(t=1,n=64;e>=n;t++,n<<=6);return t}function a(e){for(var t=0,n=0,r=0,o=0,i=0,s=e.length;s>=16;)t=t+e[i+0]|0,n=n+e[i+1]|0,r=r+e[i+2]|0,o=o+e[i+3]|0,t=t+e[i+4]|0,n=n+e[i+5]|0,r=r+e[i+6]|0,o=o+e[i+7]|0,t=t+e[i+8]|0,n=n+e[i+9]|0,r=r+e[i+10]|0,o=o+e[i+11]|0,t=t+e[i+12]|0,n=n+e[i+13]|0,r=r+e[i+14]|0,o=o+e[i+15]|0,i+=16,s-=16;for(;s>=4;)t=t+e[i+0]|0,n=n+e[i+1]|0,r=r+e[i+2]|0,o=o+e[i+3]|0,i+=4,s-=4;switch(o=((o+(r<<8)|0)+(n<<16)|0)+(t<<24)|0,s){case 3:o=o+(e[i+2]<<8)|0;case 2:o=o+(e[i+1]<<16)|0;case 1:o=o+(e[i+0]<<24)|0}return o>>>0}return o.prototype.haveBytes=function(){return this.pos<this.a.length},o.prototype.getByte=function(){var e=this.a[this.pos];if(this.pos++,this.pos>this.a.length)throw new RangeError("out of bounds");return e},o.prototype.getChar=function(){return String.fromCharCode(this.getByte())},o.prototype.getInt=function(){for(var e,t=0;this.haveBytes()&&(e=r[127&this.getByte()])>=0;)t=(t<<6)+e;return this.pos--,t>>>0},i.prototype.toArray=function(){return this.a},i.prototype.putByte=function(e){this.a.push(255&e)},i.prototype.putChar=function(e){this.putByte(e.charCodeAt(0))},i.prototype.putInt=function(e){var t,r,o=[];if(0!==e){for(t=0;e>0;t++,e>>>=6)o.push(n[63&e]);for(r=t-1;r>=0;r--)this.putByte(o[r])}else this.putChar("0")},i.prototype.putArray=function(e,t,n){for(var r=t;r<n;r++)this.a.push(e[r])},e.create=function(e,n){var r,o=new i,c=n.length,u=e.length,h=-1;if(o.putInt(c),o.putChar("\n"),u<=16)return o.putInt(c),o.putChar(":"),o.putArray(n,0,c),o.putInt(a(n)),o.putChar(";"),o.toArray();var l=Math.ceil(u/16),f=new Array(l),d=new Array(l);for(r=0;r<f.length;r++)f[r]=-1;for(r=0;r<d.length;r++)d[r]=-1;var p,m=new t;for(r=0;r<u-16;r+=16)m.init(e,r),p=m.value()%l,f[r/16]=d[p],d[p]=r/16;for(var v,g,y,b,_,w=0;w+16<c;)for(b=0,_=0,m.init(n,w),r=0,y=0;;){var C=250;for(g=d[p=m.value()%l];g>=0&&C-- >0;){var S,O,E,A,k,I,P;for(A=0,I=v=16*g,P=w+r;I<u&&P<c&&e[I]===n[P];A++,I++,P++);for(A--,k=1;k<v&&k<=r&&e[v-k]===n[w+r-k];k++);O=v- --k,E=r-k,(S=A+k+1)>=s(r-k)+s(S)+s(O)+3&&S>y&&(y=S,b=v-k,_=E),g=f[g]}if(y>0){_>0&&(o.putInt(_),o.putChar(":"),o.putArray(n,w,w+_),w+=_),w+=y,o.putInt(y),o.putChar("@"),o.putInt(b),o.putChar(","),b+y-1>h&&(h=b+y-1),y=0;break}if(w+r+16>=c){o.putInt(c-w),o.putChar(":"),o.putArray(n,w,w+c-w),w=c;break}m.next(n[w+r+16]),r++}return w<c&&(o.putInt(c-w),o.putChar(":"),o.putArray(n,w,w+c-w)),o.putInt(a(n)),o.putChar(";"),o.toArray()},e.outputSize=function(e){var t=new o(e),n=t.getInt();if("\n"!==t.getChar())throw new Error("size integer not terminated by '\\n'");return n},e.apply=function(e,t,n){var r,s=0,c=new o(t),u=e.length,h=t.length;if(r=c.getInt(),"\n"!==c.getChar())throw new Error("size integer not terminated by '\\n'");for(var l=new i;c.haveBytes();){var f,d;switch(f=c.getInt(),c.getChar()){case"@":if(d=c.getInt(),c.haveBytes()&&","!==c.getChar())throw new Error("copy command not terminated by ','");if((s+=f)>r)throw new Error("copy exceeds output file size");if(d+f>u)throw new Error("copy extends past end of input");l.putArray(e,d,d+f);break;case":":if((s+=f)>r)throw new Error("insert command gives an output larger than predicted");if(f>h)throw new Error("insert count exceeds size of delta");l.putArray(c.a,c.pos,c.pos+f),c.pos+=f;break;case";":var p=l.toArray();if((!n||!1!==n.verifyChecksum)&&f!==a(p))throw new Error("bad checksum");if(s!==r)throw new Error("generated size does not match predicted size");return p;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")},e},e.exports?e.exports=o():r.fossilDelta=o()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaSerializer=void 0;var r=n(15),o=function(){function e(){}return e.prototype.setState=function(e){this.state.decode(e)},e.prototype.getState=function(){return this.state},e.prototype.patch=function(e){this.state.decode(e)},e.prototype.teardown=function(){},e.prototype.handshake=function(e,t){this.state?(new r.Reflection).decode(e,t):this.state=r.Reflection.decode(e)},e}();t.SchemaSerializer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;var r=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return void 0===t&&(t=!1),this.handlers.push(e),this},e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))},e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))},e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}();t.EventEmitter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dumpChanges=void 0;var r=n(15),o=n(1),i=n(0);t.dumpChanges=function e(t){for(var n={},s=t.$changes,a=t._fieldsByIndex||{},c=0,u=Array.from(s.changes);c<u.length;c++){var h=u[c],l=a[h]||h;t[l]instanceof o.MapSchema||t[l]instanceof i.ArraySchema||t[l]instanceof r.Schema?n[l]=e(t[l]):n[l]=t[l]}return n}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.Reflection=t.ReflectionType=t.ReflectionField=void 0;var s=n(17),a=n(3),c=n(0),u=n(1),h=new s.Context,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([s.type("string",h)],t.prototype,"name",void 0),i([s.type("string",h)],t.prototype,"type",void 0),i([s.type("uint8",h)],t.prototype,"referencedType",void 0),t}(a.Schema);t.ReflectionField=l;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new c.ArraySchema,t}return o(t,e),i([s.type("uint8",h)],t.prototype,"id",void 0),i([s.type([l],h)],t.prototype,"fields",void 0),t}(a.Schema);t.ReflectionType=f;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new c.ArraySchema,t}return o(t,e),t.encode=function(e){var n=e.constructor,r=new t;r.rootType=n._typeid;var o=function(e,t){for(var n in t){var o=new l;o.name=n;var i=void 0;if("string"==typeof t[n])i=t[n];else{var s="function"==typeof t[n],a=Array.isArray(t[n]),c=!a&&t[n].map,u=void 0;s?(i="ref",u=t[n]):a?(i="array","string"==typeof t[n][0]?i+=":"+t[n][0]:u=t[n][0]):c&&(i="map","string"==typeof t[n].map?i+=":"+t[n].map:u=t[n].map),o.referencedType=u?u._typeid:255}o.type=i,e.fields.push(o)}r.types.push(e)},i=n._context.types;for(var s in i){var a=new f;a.id=Number(s),o(a,i[s]._schema)}return r.encodeAll()},t.decode=function(e){var n=new s.Context,r=new t;r.decode(e);var i=r.types.reduce((function(e,t){return e[t.id]=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(a.Schema),e}),{});r.types.forEach((function(e,t){e.fields.forEach((function(t){var r=i[e.id];if(void 0!==t.referencedType){var o=i[t.referencedType];o||(o=t.type.split(":")[1]),0===t.type.indexOf("array")?s.type([o],n)(r.prototype,t.name):0===t.type.indexOf("map")?s.type({map:o},n)(r.prototype,t.name):"ref"===t.type&&s.type(o,n)(r.prototype,t.name)}else s.type(t.type,n)(r.prototype,t.name)}))}));var h=i[r.rootType],l=new h;for(var f in h._schema){var d=h._schema[f];if("string"!=typeof d){var p="function"==typeof d,m=Array.isArray(d),v=!m&&d.map;l[f]=m?new c.ArraySchema:v?new u.MapSchema:p?new d:void 0}}return l},i([s.type([f],h)],t.prototype,"types",void 0),i([s.type("uint8",h)],t.prototype,"rootType",void 0),t}(a.Schema);t.Reflection=d},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(18),i=n(49),s=n(68),a=n(5),c=n(21),u=n(22);class h extends o.EventEmitter{constructor(e){super(),this.onRequest=e=>{a.debug("Handle request from server: [method:%s, data:%o]",e.method,e.data)},this.onNotification=e=>{const{method:t,data:n}=e;switch(a.info("Handle notification from server: [method:%s, data:%o]",t,n),t){case"peer-join":{const{uid:e,info:t}=n;this.emit("peer-join",e,t);break}case"peer-leave":{const{uid:e}=n;this.emit("peer-leave",e);break}case"stream-add":{const{mid:e,info:t,tracks:r}=n;if(e){const t=function(e){const t=new Map;for(const n of Object.keys(e))t.set(n,e[n]);return t}(r);this.knownStreams.set(e,t)}this.emit("stream-add",e,t);break}case"stream-remove":{const{mid:e}=n,t=this.streams[e];this.emit("stream-remove",t),t.close();break}case"broadcast":{const{uid:e,info:t}=n;this.emit("broadcast",e,t);break}}};const t=e.uid?e.uid:s.v4();if(!e||!e.url)throw new Error("Undefined config or config.url in ion-sdk.");const n=new URL(e.url);n.searchParams.append("peer",t);const r=new i.WebSocketTransport(n.toString(),e.options);a.setLevel(void 0!==e.loglevel?e.loglevel:a.levels.WARN),this.knownStreams=new Map,this.uid=t,this.streams={},this.dispatch=new i.Peer(r),e.rtc&&u.default.setRTCConfiguration(e.rtc),c.Stream.setDispatch(this.dispatch),this.dispatch.on("open",()=>{a.info('Peer "open" event'),this.emit("transport-open")}),this.dispatch.on("disconnected",()=>{a.info('Peer "disconnected" event'),this.emit("transport-failed")}),this.dispatch.on("close",()=>{a.info('Peer "close" event'),this.emit("transport-closed")}),this.dispatch.on("request",this.onRequest),this.dispatch.on("notification",this.onNotification)}broadcast(e){return this.dispatch.request("broadcast",{rid:this.rid,uid:this.uid,info:e})}join(e,t={name:"Guest"}){return r(this,void 0,void 0,(function*(){this.rid=e;try{const e=yield this.dispatch.request("join",{rid:this.rid,uid:this.uid,info:t});a.info("join success: result => "+JSON.stringify(e))}catch(e){a.error("join reject: error =>"+e)}}))}publish(e){return r(this,void 0,void 0,(function*(){if(!this.rid)throw new Error("You must join a room before publishing.");return this.local=e,yield e.publish(this.rid)}))}subscribe(e){return r(this,void 0,void 0,(function*(){if(!this.rid)throw new Error("You must join a room before subscribing.");const t=this.knownStreams.get(e);if(!t)throw new Error("Subscribe mid is not known.");const n=yield c.RemoteStream.getRemoteMedia(this.rid,e,t);return this.streams[e]=n,n}))}leave(){return r(this,void 0,void 0,(function*(){try{const e=yield this.dispatch.request("leave",{rid:this.rid,uid:this.uid});this.local&&this.local.unpublish(),Object.values(this.streams).forEach(e=>e.unsubscribe()),this.knownStreams.clear(),a.info("leave success: result => "+JSON.stringify(e))}catch(e){a.error("leave reject: error =>"+e)}}))}close(){this.dispatch.close()}}t.default=h},function(e,t,n){const{version:r}=n(50),o=n(51),i=n(57);t.version=r,t.Peer=o,t.WebSocketTransport=i},function(e){e.exports=JSON.parse('{"_args":[["protoo-client@4.0.4","/home/kasparsj/Work/metaverse"]],"_from":"protoo-client@4.0.4","_id":"protoo-client@4.0.4","_inBundle":false,"_integrity":"sha512-+WZUJJTlBSTWYeNu0Tv8SGI3kjettLvr2IUdBsAfioi0Szf8peeky79h6li7gThA3pIpNC+A+IuCUWaK7MlFfQ==","_location":"/hubs-colyseus-ion-adapter/protoo-client","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"protoo-client@4.0.4","name":"protoo-client","escapedName":"protoo-client","rawSpec":"4.0.4","saveSpec":null,"fetchSpec":"4.0.4"},"_requiredBy":["/hubs-colyseus-ion-adapter/ion-sdk-js"],"_resolved":"https://registry.npmjs.org/protoo-client/-/protoo-client-4.0.4.tgz","_spec":"4.0.4","_where":"/home/kasparsj/Work/metaverse","author":{"name":"Iñaki Baz Castillo","email":"ibc@aliax.net"},"bugs":{"url":"https://github.com/ibc/protoo/issues"},"dependencies":{"debug":"^4.1.1","events":"^3.1.0","retry":"^0.12.0","websocket":"^1.0.31"},"description":"protoo JavaScript client module","devDependencies":{"eslint":"^5.16.0"},"engines":{"node":">=8.0.0"},"homepage":"https://protoojs.org","keywords":["nodejs","browser","websocket"],"license":"MIT","main":"lib/index.js","name":"protoo-client","optionalDependencies":{"websocket":"^1.0.31"},"repository":{"type":"git","url":"git+https://github.com/ibc/protoo.git"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"version":"4.0.4"}')},function(e,t,n){const r=n(4),o=n(19),i=n(20),s=new r("Peer");e.exports=class extends o{constructor(e){super(s),s.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){s.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t){const n=i.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,n.id),await this._transport.send(n),new Promise((e,t)=>{const r=1500*(15+.1*this._sents.size),o={id:n.id,method:n.method,resolve:t=>{this._sents.delete(n.id)&&(clearTimeout(o.timer),e(t))},reject:e=>{this._sents.delete(n.id)&&(clearTimeout(o.timer),t(e))},timer:setTimeout(()=>{this._sents.delete(n.id)&&t(new Error("request timeout"))},r),close:()=>{clearTimeout(o.timer),t(new Error("peer closed"))}};this._sents.set(n.id,o)})}async notify(e,t){const n=i.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(n)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))});this._transport.on("open",()=>{this._closed||(s.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(s.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(s.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,s.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)})}_handleRequest(e){try{this.emit("request",e,t=>{const n=i.createSuccessResponse(e,t);this._transport.send(n).catch(()=>{})},(t,n)=>{t instanceof Error?(t=500,n=String(t)):"number"==typeof t&&n instanceof Error&&(n=String(n));const r=i.createErrorResponse(e,t,n);this._transport.send(r).catch(()=>{})})}catch(t){const n=i.createErrorResponse(e,500,String(t));this._transport.send(n).catch(()=>{})}}_handleResponse(e){const t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{const n=new Error(e.errorReason);n.code=e.errorCode,t.reject(n)}else s.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}},function(e,t,n){(function(r){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(54)(t);const{formatters:o}=e.exports;o.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(53))},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],h=!1,l=-1;function f(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&d())}function d(){if(!h){var e=a(f);h=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||h||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let n;function s(...e){if(!s.enabled)return;const t=s,o=Number(new Date),i=o-(n||o);t.diff=i,t.prev=n,t.curr=o,n=o,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,o)=>{if("%%"===n)return n;a++;const i=r.formatters[o];if("function"==typeof i){const r=e[a];n=i.call(t,r),e.splice(a,1),a--}return n}),r.formatArgs.call(t,e);(t.log||r.log).apply(t,e)}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=o,s.extend=i,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function o(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){const n=r(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},r.disable=function(){const e=[...r.names.map(s),...r.skips.map(s).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(55),Object.keys(e).forEach(t=>{r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){var n=1e3,r=6e4,o=60*r,i=24*o;function s(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*o;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return s(e,t,i,"day");if(t>=o)return s(e,t,o,"hour");if(t>=r)return s(e,t,r,"minute");if(t>=n)return s(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,n){const r=n(58).w3cwebsocket,o=n(62),i=n(4),s=n(19),a=n(20),c={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},u=new i("WebSocketTransport");e.exports=class extends s{constructor(e,t){super(u),u.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){u.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw u.warn("send() failed:%o",e),e}}_runWebSocket(){const e=o.operation(this._options.retry||c);let t=!1;e.attempt(n=>{this._closed?e.stop():(u.debug("_runWebSocket() [currentAttempt:%s]",n),this._ws=new r(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=r=>{if(!this._closed){if(u.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',r.wasClean,r.code,r.reason),4e3!==r.code){if(t){if(e.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",n),this._closed)return;if(e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||u.error('WebSocket "error" event')},this._ws.onmessage=e=>{if(this._closed)return;const t=a.parse(e.data);t&&(0!==this.listenerCount("message")?this.safeEmit("message",t):u.error('no listeners for WebSocket "message" event, ignoring received message'))})})}}},function(e,t,n){var r;try{r=n(59)}catch(e){}finally{if(r||"undefined"==typeof window||(r=window),!r)throw new Error("Could not determine global this")}var o=r.WebSocket||r.MozWebSocket,i=n(60);function s(e,t){return t?new o(e,t):new o(e)}o&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return o[e]}})})),e.exports={w3cwebsocket:o?s:null,version:i}},function(e,t){var n=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}()},function(e,t,n){e.exports=n(61).version},function(e){e.exports=JSON.parse('{"_args":[["websocket@1.0.31","/home/kasparsj/Work/metaverse"]],"_from":"websocket@1.0.31","_id":"websocket@1.0.31","_inBundle":false,"_integrity":"sha512-VAouplvGKPiKFDTeCCO65vYHsyay8DqoBSlzIO3fayrfOgU94lQN5a1uWVnFrMLceTJw/+fQXR5PGbUVRaHshQ==","_location":"/hubs-colyseus-ion-adapter/websocket","_optional":true,"_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"websocket@1.0.31","name":"websocket","escapedName":"websocket","rawSpec":"1.0.31","saveSpec":null,"fetchSpec":"1.0.31"},"_requiredBy":["/hubs-colyseus-ion-adapter/protoo-client"],"_resolved":"https://registry.npmjs.org/websocket/-/websocket-1.0.31.tgz","_spec":"1.0.31","_where":"/home/kasparsj/Work/metaverse","author":{"name":"Brian McKelvey","email":"theturtle32@gmail.com","url":"https://github.com/theturtle32"},"browser":"lib/browser.js","bugs":{"url":"https://github.com/theturtle32/WebSocket-Node/issues"},"config":{"verbose":false},"contributors":[{"name":"Iñaki Baz Castillo","email":"ibc@aliax.net","url":"http://dev.sipdoc.net"}],"dependencies":{"debug":"^2.2.0","es5-ext":"^0.10.50","nan":"^2.14.0","typedarray-to-buffer":"^3.1.5","yaeti":"^0.0.6"},"description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","devDependencies":{"buffer-equal":"^1.0.0","faucet":"^0.0.1","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint":"^2.0.0","jshint-stylish":"^2.2.1","tape":"^4.9.1"},"directories":{"lib":"./lib"},"engines":{"node":">=0.10.0"},"homepage":"https://github.com/theturtle32/WebSocket-Node","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"license":"Apache-2.0","main":"index","name":"websocket","repository":{"type":"git","url":"git+https://github.com/theturtle32/WebSocket-Node.git"},"scripts":{"gulp":"gulp","install":"(node-gyp rebuild 2> builderror.log) || (exit 0)","test":"faucet test/unit"},"version":"1.0.31"}')},function(e,t,n){e.exports=n(63)},function(e,t,n){var r=n(64);t.operation=function(e){var n=t.timeouts(e);return new r(n,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in e)t[n]=e[n];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],o=0;o<t.retries;o++)r.push(this.createTimeout(o,t));return e&&e.forever&&!r.length&&r.push(this.createTimeout(o,t)),r.sort((function(e,t){return e-t})),r},t.createTimeout=function(e,t){var n=t.randomize?Math.random()+1:1,r=Math.round(n*t.minTimeout*Math.pow(t.factor,e));return r=Math.min(r,t.maxTimeout)},t.wrap=function(e,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var o in r=[],e)"function"==typeof e[o]&&r.push(o);for(var i=0;i<r.length;i++){var s=r[i],a=e[s];e[s]=function(r){var o=t.operation(n),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){o.retry(e)||(e&&(arguments[0]=o.mainError()),s.apply(this,arguments))})),o.attempt((function(){r.apply(e,i)}))}.bind(e,a),e[s].options=n}}},function(e,t){function n(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),n=this._timeouts.shift()}var r=this,o=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n);return this._options.unref&&o.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,n=0,r=0;r<this._errors.length;r++){var o=this._errors[r],i=o.message,s=(e[i]||0)+1;e[i]=s,s>=n&&(t=o,n=s)}return t}},function(e,t,n){var r=n(66),o=n(67);t.write=o,t.parse=r.parse,t.parseParams=r.parseParams,t.parseFmtpConfig=r.parseFmtpConfig,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,n){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,n,o){if(o&&!n)t[o]=r(e[1]);else for(var i=0;i<n.length;i+=1)null!=e[i+1]&&(t[n[i]]=r(e[i+1]))}(n.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=n(23),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var a=0;a<(i[t]||[]).length;a+=1){var c=i[t][a];if(c.reg.test(s))return o(c,r,s)}})),t.media=n,t};var a=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=r(n[1]):1===n.length&&t.length>1&&(e[n[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),o=0;o<n.length;o+=3)t.push({component:n[o],ip:n[o+1],port:n[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}}))}))}},function(e,t,n){var r=n(23),o=/%[sdv%]/g,i=function(e){var t=1,n=arguments,r=n.length;return e.replace(o,(function(e){if(t>=r)return e;var o=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}}))},s=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?r.push(n[t.name][s]):r.push(n[t.names[o]])}else r.push(n[t.name]);return i.apply(null,r)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var n=t.outerOrder||a,o=t.innerOrder||c,i=[];return n.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?i.push(s(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){i.push(s(t,n,e))}))}))})),e.media.forEach((function(e){i.push(s("m",r.m[0],e)),o.forEach((function(t){r[t].forEach((function(n){n.name in e&&null!=e[n.name]?i.push(s(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach((function(e){i.push(s(t,n,e))}))}))}))})),i.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";n.r(t),n.d(t,"v1",(function(){return d})),n.d(t,"v3",(function(){return C})),n.d(t,"v4",(function(){return S})),n.d(t,"v5",(function(){return A}));var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),o=new Uint8Array(16);function i(){if(!r)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}for(var s=[],a=0;a<256;++a)s.push((a+256).toString(16).substr(1));var c,u,h=function(e,t){var n=t||0;return(s[e[n+0]]+s[e[n+1]]+s[e[n+2]]+s[e[n+3]]+"-"+s[e[n+4]]+s[e[n+5]]+"-"+s[e[n+6]]+s[e[n+7]]+"-"+s[e[n+8]]+s[e[n+9]]+"-"+s[e[n+10]]+s[e[n+11]]+s[e[n+12]]+s[e[n+13]]+s[e[n+14]]+s[e[n+15]]).toLowerCase()},l=0,f=0;var d=function(e,t,n){var r=t&&n||0,o=t||new Array(16),s=(e=e||{}).node||c,a=void 0!==e.clockseq?e.clockseq:u;if(null==s||null==a){var d=e.random||(e.rng||i)();null==s&&(s=c=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==a&&(a=u=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:f+1,v=p-l+(m-f)/1e4;if(v<0&&void 0===e.clockseq&&(a=a+1&16383),(v<0||p>l)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=p,f=m,u=a;var g=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;o[r++]=g>>>24&255,o[r++]=g>>>16&255,o[r++]=g>>>8&255,o[r++]=255&g;var y=p/4294967296*1e4&268435455;o[r++]=y>>>8&255,o[r++]=255&y,o[r++]=y>>>24&15|16,o[r++]=y>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var b=0;b<6;++b)o[r+b]=s[b];return t||h(o)};var p=function(e,t,n){function r(e,r,o,i){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(r)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(r)||16!==r.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var s=n(r.concat(e));if(s[6]=15&s[6]|t,s[8]=63&s[8]|128,o){i=i||0;for(var a=0;a<16;++a)o[i+a]=s[a];return o}return h(s)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r};function m(e){return 14+(e+64>>>9<<4)+1}function v(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function g(e,t,n,r,o,i){return v((s=v(v(t,e),v(r,i)))<<(a=o)|s>>>32-a,n);var s,a}function y(e,t,n,r,o,i,s){return g(t&n|~t&r,e,t,o,i,s)}function b(e,t,n,r,o,i,s){return g(t&r|n&~r,e,t,o,i,s)}function _(e,t,n,r,o,i,s){return g(t^n^r,e,t,o,i,s)}function w(e,t,n,r,o,i,s){return g(n^(t|~r),e,t,o,i,s)}var C=p("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r=0;r<n;r+=8){var o=e[r>>5]>>>r%32&255,i=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[m(t)-1]=t;for(var n=1732584193,r=-271733879,o=-1732584194,i=271733878,s=0;s<e.length;s+=16){var a=n,c=r,u=o,h=i;n=y(n,r,o,i,e[s],7,-680876936),i=y(i,n,r,o,e[s+1],12,-389564586),o=y(o,i,n,r,e[s+2],17,606105819),r=y(r,o,i,n,e[s+3],22,-1044525330),n=y(n,r,o,i,e[s+4],7,-176418897),i=y(i,n,r,o,e[s+5],12,1200080426),o=y(o,i,n,r,e[s+6],17,-1473231341),r=y(r,o,i,n,e[s+7],22,-45705983),n=y(n,r,o,i,e[s+8],7,1770035416),i=y(i,n,r,o,e[s+9],12,-1958414417),o=y(o,i,n,r,e[s+10],17,-42063),r=y(r,o,i,n,e[s+11],22,-1990404162),n=y(n,r,o,i,e[s+12],7,1804603682),i=y(i,n,r,o,e[s+13],12,-40341101),o=y(o,i,n,r,e[s+14],17,-1502002290),r=y(r,o,i,n,e[s+15],22,1236535329),n=b(n,r,o,i,e[s+1],5,-165796510),i=b(i,n,r,o,e[s+6],9,-1069501632),o=b(o,i,n,r,e[s+11],14,643717713),r=b(r,o,i,n,e[s],20,-373897302),n=b(n,r,o,i,e[s+5],5,-701558691),i=b(i,n,r,o,e[s+10],9,38016083),o=b(o,i,n,r,e[s+15],14,-660478335),r=b(r,o,i,n,e[s+4],20,-405537848),n=b(n,r,o,i,e[s+9],5,568446438),i=b(i,n,r,o,e[s+14],9,-1019803690),o=b(o,i,n,r,e[s+3],14,-187363961),r=b(r,o,i,n,e[s+8],20,1163531501),n=b(n,r,o,i,e[s+13],5,-1444681467),i=b(i,n,r,o,e[s+2],9,-51403784),o=b(o,i,n,r,e[s+7],14,1735328473),r=b(r,o,i,n,e[s+12],20,-1926607734),n=_(n,r,o,i,e[s+5],4,-378558),i=_(i,n,r,o,e[s+8],11,-2022574463),o=_(o,i,n,r,e[s+11],16,1839030562),r=_(r,o,i,n,e[s+14],23,-35309556),n=_(n,r,o,i,e[s+1],4,-1530992060),i=_(i,n,r,o,e[s+4],11,1272893353),o=_(o,i,n,r,e[s+7],16,-155497632),r=_(r,o,i,n,e[s+10],23,-1094730640),n=_(n,r,o,i,e[s+13],4,681279174),i=_(i,n,r,o,e[s],11,-358537222),o=_(o,i,n,r,e[s+3],16,-722521979),r=_(r,o,i,n,e[s+6],23,76029189),n=_(n,r,o,i,e[s+9],4,-640364487),i=_(i,n,r,o,e[s+12],11,-421815835),o=_(o,i,n,r,e[s+15],16,530742520),r=_(r,o,i,n,e[s+2],23,-995338651),n=w(n,r,o,i,e[s],6,-198630844),i=w(i,n,r,o,e[s+7],10,1126891415),o=w(o,i,n,r,e[s+14],15,-1416354905),r=w(r,o,i,n,e[s+5],21,-57434055),n=w(n,r,o,i,e[s+12],6,1700485571),i=w(i,n,r,o,e[s+3],10,-1894986606),o=w(o,i,n,r,e[s+10],15,-1051523),r=w(r,o,i,n,e[s+1],21,-2054922799),n=w(n,r,o,i,e[s+8],6,1873313359),i=w(i,n,r,o,e[s+15],10,-30611744),o=w(o,i,n,r,e[s+6],15,-1560198380),r=w(r,o,i,n,e[s+13],21,1309151649),n=w(n,r,o,i,e[s+4],6,-145523070),i=w(i,n,r,o,e[s+11],10,-1120210379),o=w(o,i,n,r,e[s+2],15,718787259),r=w(r,o,i,n,e[s+9],21,-343485551),n=v(n,a),r=v(r,c),o=v(o,u),i=v(i,h)}return[n,r,o,i]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(m(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));var S=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return h(r)};function O(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function E(e,t){return e<<t|e>>>32-t}var A=p("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var o=0;o<r.length;++o)e.push(r.charCodeAt(o))}e.push(128);for(var i=e.length/4+2,s=Math.ceil(i/16),a=new Array(s),c=0;c<s;++c){for(var u=new Uint32Array(16),h=0;h<16;++h)u[h]=e[64*c+4*h]<<24|e[64*c+4*h+1]<<16|e[64*c+4*h+2]<<8|e[64*c+4*h+3];a[c]=u}a[s-1][14]=8*(e.length-1)/Math.pow(2,32),a[s-1][14]=Math.floor(a[s-1][14]),a[s-1][15]=8*(e.length-1)&4294967295;for(var l=0;l<s;++l){for(var f=new Uint32Array(80),d=0;d<16;++d)f[d]=a[l][d];for(var p=16;p<80;++p)f[p]=E(f[p-3]^f[p-8]^f[p-14]^f[p-16],1);for(var m=n[0],v=n[1],g=n[2],y=n[3],b=n[4],_=0;_<80;++_){var w=Math.floor(_/20),C=E(m,5)+O(w,v,g,y)+b+t[w]+f[_]>>>0;b=y,y=g,g=E(v,30)>>>0,v=m,m=C}n[0]=n[0]+m>>>0,n[1]=n[1]+v>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}))}]);
//# sourceMappingURL=hubs-colyseus-ion-adapter.min.js.map